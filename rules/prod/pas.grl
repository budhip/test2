rule SetDefaultTransformAcuanTransaction "Default transformation Acuan transaction to PAS transaction" salience 15 {
    when
        Acuan.AcuanStatus == "SUCCESS"
    then
        Journal.TransactionID = Acuan.Id;
        Journal.ReferenceNumber = Acuan.RefNumber;
        Journal.OrderType = Acuan.OrderType;
        Journal.TransactionDate = Acuan.TransactionTime;
        Journal.Currency = Acuan.Currency;
        Journal.Metadata = Acuan.Meta;

        JournalDebit1.TransactionType = Acuan.TransactionType;
        JournalDebit1.TransactionTypeName = Acuan.TransactionTypeName;
        JournalDebit1.Amount = Acuan.Amount;
        JournalDebit1.IsDebit = true;

        JournalCredit1.TransactionType = Acuan.TransactionType;
        JournalCredit1.TransactionTypeName = Acuan.TransactionTypeName;
        JournalCredit1.Amount = Acuan.Amount;
        JournalCredit1.IsDebit = false;

        JournalDebit2.TransactionType = Acuan.TransactionType;
        JournalDebit2.TransactionTypeName = Acuan.TransactionTypeName;
        JournalDebit2.Amount = Acuan.Amount;
        JournalDebit2.IsDebit = true;

        JournalCredit2.TransactionType = Acuan.TransactionType;
        JournalCredit2.TransactionTypeName = Acuan.TransactionTypeName;
        JournalCredit2.Amount = Acuan.Amount;
        JournalCredit2.IsDebit = false;

        Transaction.IsReadyToPublish = false;
        Retract("SetDefaultTransformAcuanTransaction");
}

rule TransformAcuanTransactionDisbursementPLBroilerX "When it's disbursement partnership loan broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" && 
        (Acuan.GetProductType() == "broilerx" || Acuan.Description == "DISB BROILERX") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000001";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLBroilerX");
}

rule TransformAcuanTransactionDisbursementPLChickin "When it's disbursement partnership loan chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" &&
        (Acuan.GetProductType() == "chickin" || Acuan.Description == "DISB CHICKIN") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000002";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLChickin");
}

rule TransformAcuanTransactionDisbursementPLModal "When it's disbursement partnership loan modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" && 
        (Acuan.GetProductType() == "modal" || Acuan.Description == "DISB MODAL") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLModal");
}

rule TransformAcuanTransactionPPH "When it's transaction pph, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPH" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPH");
}

rule TransformAcuanTransactionPPN "When it's transaction ppn, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPN" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPN");
}

rule TransformAcuanTransactionInterest "When it's transaction interest, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWIT" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionInterest");
}

rule TransformAcuanTransactionIncome "When it's transaction income, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWAF" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionIncome");
}

rule TransformAcuanTransactionDisbursementOutstandingPLBroilerX "When it's disbursement outstanding partnership loan broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000001";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLBroilerX");
}

rule TransformAcuanTransactionDisbursementOutstandingPLChickin "When it's disbursement outstanding partnership loan chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000002";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLChickin");
}

rule TransformAcuanTransactionDisbursementOutstandingPLModal "When it's disbursement outstanding partnership loan modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" && 
        Acuan.Description == "MODAL_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000005";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);
     
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLModal");
}

rule TransformAcuanTransactionAdminFeePLBroilerX "When it's admin fee partnership loan broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAC" &&
        Acuan.Description == "BROILERX_LOAN"
    then
        JournalDebit1.Account = "121001000000001";
        JournalDebit1.Narrative = "Deduction of administrative fees on funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "221001000000003";
        JournalCredit1.Narrative = "Deduction of administrative fees on funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeePLBroilerX");
}

rule TransformAcuanTransactionAdminFeePLChickin "When it's admin fee partnership loan chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAC" &&
        Acuan.Description == "CHICKIN_LOAN"
    then
        JournalDebit1.Account = "121001000000002";
        JournalDebit1.Narrative = "Deduction of administrative fees on funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "221001000000004";
        JournalCredit1.Narrative = "Deduction of administrative fees on funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeePLChickin");
}

rule TransformAcuanTransactionPPNAmarthaAdminFeePLBroilerX "When it's ppn amartha from admin fee partnership loan broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAD" &&
        Acuan.Description == "BROILERX_LOAN"
    then
        JournalDebit1.Account = "121001000000001";
        JournalDebit1.Narrative = "Tax on administrative fees";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "241001000000003";
        JournalCredit1.Narrative = "Tax on administrative fees";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPNAmarthaAdminFeePLBroilerX");
}

rule TransformAcuanTransactionPPNAmarthaAdminFeePLChickin "When it's ppn amartha from admin fee partnership loan chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAD" &&
        Acuan.Description == "CHICKIN_LOAN"
    then
        JournalDebit1.Account = "121001000000002";
        JournalDebit1.Narrative = "Tax on administrative fees";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "241001000000004";
        JournalCredit1.Narrative = "Tax on administrative fees";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPNAmarthaAdminFeePLChickin");
}

rule TransformAcuanTransactionRepaymentPLChickin "When acuan transaction type is repayment partner loan chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        (Acuan.GetProductType() == "chickin" || Acuan.Description == "CHICKIN REPAYMENT")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000004";
        JournalCredit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentPLChickin");
}

rule TransformAcuanTransactionRepaymentPLBroilerX "When acuan transaction type is repayment partner loan broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        (Acuan.GetProductType() == "broilerx" || Acuan.Description == "BROILERX REPAYMENT")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000003";
        JournalCredit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentPLBroilerX");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderProfitChickin "When acuan transaction type is forward repayment partner loan - lender profit chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000004";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderProfitChickin");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderProfitBroilerX "When acuan transaction type is forward repayment partner loan - lender profit broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000003";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderProfitBroilerX");
}

rule TransformAcuanTransactionForwardRepaymentLenderProfitModalLoan "When acuan transaction type is forward repayment - lender profit modal loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "MODAL_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000006";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderProfitModalLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxChickin "When acuan transaction type is forward repayment partner loan - lender tax income chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000004";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxChickin");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxBroilerX "When acuan transaction type is forward repayment partner loan - lender tax income broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000003";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxBroilerX");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderPrincipal "When acuan transaction type is forward repayment partner loan - lender principal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAD"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding principal to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding principal to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderPrincipal");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionChickin "When acuan transaction type is forward repayment partner loan - loan deduction chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000004";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionChickin");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionBroilerX "When acuan transaction type is forward repayment partner loan - loan deduction broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000003";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionBroilerX");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionModalLoan "When acuan transaction type is forward repayment partner loan - loan deduction modal loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "MODAL_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000006";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionModalLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionGroupLoan "When acuan transaction type is forward repayment partner loan - loan deduction group loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionGroupLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaChickin "When acuan transaction type is forward repayment partner loan - interest amartha chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000004";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaChickin");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaBroilerX "When acuan transaction type is forward repayment partner loan - interest amartha broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000003";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaBroilerX");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaModalLoan "When acuan transaction type is forward repayment partner loan - interest amartha modal loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "MODAL_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000006";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaModalLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaGroupLoan "When acuan transaction type is forward repayment partner loan - interest amartha group loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaGroupLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaChickin "When acuan transaction type is forward repayment partner loan - ppn amartha chickin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000004";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaChickin");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaBroilerX "When acuan transaction type is forward repayment partner loan - ppn amartha broilerX, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000003";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaBroilerX");
}

rule TransformAcuanTransactionInvestment "When acuan transaction type is invesment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INVMT"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Investment Lender " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Investment Lender " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionInvestment");
}

rule TransformAcuanTransactionTopupLenderVAMandiri "When acuan transaction type is Top up Lender via VA Mandiri, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVM"
    then
        JournalDebit1.Account = "114001000000001";
        JournalDebit1.Narrative = "Top up Lender via VA Mandiri";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top up Lender via VA Mandiri";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderVAMandiri");
}

rule TransformAcuanTransactionTopupLenderVAPermata "When acuan transaction type is Top up Lender via VA Permata, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVP"
    then
        JournalDebit1.Account = "114001000000004";
        JournalDebit1.Narrative = "Top up Lender via VA Permata";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top up Lender via VA Permata";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderVAPermata");
}

rule TransformAcuanTransactionTopupLenderVABCA "When acuan transaction type is Top up Lender via VA BCA, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVB"
    then
        JournalDebit1.Account = "114001000000020";
        JournalDebit1.Narrative = "Top Up Lender via VA BCA";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via VA BCA";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderVABCA");
}

rule TransformAcuanTransactionCashoutLender "When acuan transaction type is Cashout Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTLR"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Cash Out Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetByAccountNumberAltIDLegacyID(Acuan.GetSourceBankAccountInMeta());
        JournalCredit1.Narrative = "Cash Out Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionCashoutLender");
}

rule TransformAcuanTransactionTopUpPocketOTC1 "When acuan transaction type is top up pocket via OTC scenario 1, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPY" && Scenario == 1 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalDebit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalCredit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPocketOTC1");
}

rule TransformAcuanTransactionTopUpPocketOTC2 "When acuan transaction type is top up pocket via OTC scenario 2, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPY" && Scenario == 2 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Negative Balance - Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalDebit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Negative Balance - Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalCredit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPocketOTC2");
}

rule TransformAcuanTransactionTopUpPocketOTC3 "When acuan transaction type is top up pocket via OTC scenario 3, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPY" && Scenario == 3 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Hybrid - Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalDebit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Hybrid - Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalCredit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.TransactionType = Acuan.TransactionType;   
        JournalDebit2.TransactionTypeName = Acuan.TransactionTypeName;
        JournalDebit2.Account = "IDR1105200042000";
        JournalDebit2.Narrative = "Hybrid - Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalDebit2.Amount = Amounts[1];
        JournalDebit2.IsDebit = true;
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.TransactionType = Acuan.TransactionType;   
        JournalCredit2.TransactionTypeName = Acuan.TransactionTypeName;
        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Hybrid - Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        JournalCredit2.Amount = Amounts[1];
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPocketOTC3");
}

rule TransformAcuanTransactionTopUpPocketOTC "When acuan transaction type is top up pocket via OTC, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPY"
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Poket/Internal Poket via OTC - " + Acuan.DestinationAccountId;        
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPocketOTC");
}

rule TransformAcuanTransactionTopUpPoketViaVA1 "When acuan transaction type is top up poket via VA Scenario 1, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVA" && Scenario == 1 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalDebit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalCredit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPoketViaVA1");
}

rule TransformAcuanTransactionTopUpPoketViaVA2 "When acuan transaction type is top up poket via VA Scenario 2, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVA" && Scenario == 2 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Negative Balance Only - Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalDebit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Negative Balance Only - Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalCredit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPoketViaVA2");
}

rule TransformAcuanTransactionTopUpPoketViaVA3 "When acuan transaction type is top up poket via VA with scenario 3, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVA" && Scenario == 3 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Hybrid - Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalDebit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Hybrid - Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalCredit1.Amount = Amounts[0];
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.TransactionType = Acuan.TransactionType;
        JournalDebit2.TransactionTypeName = Acuan.TransactionTypeName;
        JournalDebit2.Account = "IDR1105200042000";
        JournalDebit2.Narrative = "Hybrid - Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalDebit2.Amount = Amounts[1];
        JournalDebit2.IsDebit = true;
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.TransactionType = Acuan.TransactionType;
        JournalCredit2.TransactionTypeName = Acuan.TransactionTypeName;
        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Hybrid - Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        JournalCredit2.Amount = Amounts[1];
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPoketViaVA3");
}

rule TransformAcuanTransactionTopUpPoketViaVA "When acuan transaction type is top up poket via VA, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVA"
    then
        JournalDebit1.Account = "IDR1105200042000";
        JournalDebit1.Narrative = "Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Poket/Internal Poket via VA - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPoketViaVA");
}

rule TransformAcuanTransactionTemporaryTopUpViaManualUpload "When acuan transaction type is temporary top up via manual upload, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPAA"
    then
        JournalDebit1.Account = "114001000000009";
        JournalDebit1.Narrative = "Top Up Manual Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Manual Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTemporaryTopUpViaManualUpload");
}

rule TransformAcuanTransactionTemporaryCashoutLenderViaManualUpload "When acuan transaction type is temporary Cashout Lender via manual upload, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTAA"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Cash Out Manual Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Cash Out Manual Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTemporaryCashoutLenderViaManualUpload");
}

rule TransformAcuanTransactionRejectRequestCashout "When acuan transaction type is reject request cashout, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTRJ"
    then
        JournalDebit1.Account = "211001000000001";
        JournalDebit1.Narrative = "Reject Request Cashout Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Reject Request Cashout Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRejectRequestCashout");
}

rule TransformAcuanTransactionApprovalCashoutMandiri "When acuan transaction type is approval cashout mandiri, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTAM"
    then
        JournalDebit1.Account = "211001000000001";
        JournalDebit1.Narrative = "Approval Cashout via Bank Mandiri";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Approval Cashout via Bank Mandiri";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionApprovalCashoutMandiri");
}

rule TransformAcuanTransactionApprovalCashoutBriManualLender "When acuan transaction type is approval cashout bri manual lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTAR"
    then
        JournalDebit1.Account = "211001000000001";
        JournalDebit1.Narrative = "Approval Cashout Bank BRI Manual Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Approval Cashout Bank BRI Manual Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionApprovalCashoutBriManualLender");
}

rule TransformAcuanTransactionFundTransferForCashoutLender "When acuan transaction type is Fund Transfer D+1 for Cashout Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTPB"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Transfer Fund for Cash Out Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Transfer Fund for Cash Out Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFundTransferForCashoutLender");
}

rule TransformAcuanTransactionRequestCashout "When acuan transaction type is request cashout, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTRQ"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Request Cash Out Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "211001000000001";
        JournalCredit1.Narrative = "Request Cash Out Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRequestCashout");
}

rule TransformAcuanTransactionReturnCashout "When acuan transaction type is return cashout, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTRT"
    then
        JournalDebit1.Account = Transaction.GetByAccountNumberAltIDLegacyID(Acuan.GetAccountNumber());
        JournalDebit1.Narrative = "Return Cash Out Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Return Cash Out Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReturnCashout");
}

rule TransformAcuanTransactionFundTransferD1 "When acuan transaction type is Fund Transfer D+1 to BPE, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPB"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Fund Transfer D+1 to BPE";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Fund Transfer D+1 to BPE";
        Journal.Transactions.Append(JournalCredit1);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFundTransferD1");
}

rule TransformAcuanTransactionTopupLenderLinkaja "When acuan transaction type is topup lender via linkaja, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPLA"
    then
        JournalDebit1.Account = "145001000000001";
        JournalDebit1.Narrative = "Top Up Lender via LINKAJA";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via LINKAJA";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderLinkaja");
}

rule TransformAcuanTransactionTopupLenderDana "When acuan transaction type is topup lender via dana, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPDN"
    then
        JournalDebit1.Account = "145001000000001";
        JournalDebit1.Narrative = "Top Up Lender via DANA";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via DANA";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderDana");
}

rule TransformAcuanTransactionTopUpLenderViaGOPAY "When acuan transaction type is Top up Lender via GOPAY, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPGP"
    then
        JournalDebit1.Account = "145001000000002";
        JournalDebit1.Narrative = "Top Up Lender via GOPAY";
        Journal.Transactions.Append(JournalDebit1);
        
        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via GOPAY";
        Journal.Transactions.Append(JournalCredit1);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpLenderViaGOPAY");
}

rule TransformAcuanTransactionTopupLenderOVO "When acuan transaction type is topup lender via OVO, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVO"
    then
        JournalDebit1.Account = "145001000000001";
        JournalDebit1.Narrative = "Top Up Lender via OVO";
        Journal.Transactions.Append(JournalDebit1);
        
        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via OVO";
        Journal.Transactions.Append(JournalCredit1);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderOVO");
}

rule TransformAcuanTransactionTopupLenderShopeePay "When acuan transaction type is topup lender via ShopeePay, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPSP"
    then
        JournalDebit1.Account = "145001000000001";
        JournalDebit1.Narrative = "Top Up Lender via SHOPEEPAY";
        Journal.Transactions.Append(JournalDebit1);
        
        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via SHOPEEPAY";
        Journal.Transactions.Append(JournalCredit1);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderShopeePay");
}

rule TransformAcuanTransactionTopupEarnViaPoket "When acuan transaction type is Topup Earn via Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPEP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Topup for Buying Investment Earn " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1203200032000";
        JournalCredit1.Narrative = "Topup for Buying Investment Earn " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "222000000000";
        JournalDebit2.Narrative = "Topup for Buying Investment Earn " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Topup for Buying Investment Earn " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupEarnViaPoket");
}

rule TransformAcuanTransactionBuybackLoanEarnByANR "When acuan transaction type is Buyback Loan Earn by ANR, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "BBLEN"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBuybackLoanEarnByANR");
}

rule TransformAcuanTransactionApprovalCashoutBRIInstitution "When acuan transaction type is Approval Cashout BRI Manual Lender Institution Non Escrow, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTAI"
    then
        JournalDebit1.Account = "211001000000001";
        JournalDebit1.Narrative = "Approval Cashout Bank BRI Manual Lender Institution Non Escrow";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Approval Cashout Bank BRI Manual Lender Institution Non Escrow";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionApprovalCashoutBRIInstitution");
}

rule TransformAcuanReconciliationCashoutBRIInstitution "When acuan transaction type is Reconciliation Cashout Bank BRI Manual Lender Institution Escrow, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTRC"
    then
        JournalDebit1.Account = "211001000000001";
        JournalDebit1.Narrative = "Reconciliation Cashout Bank BRI Manual Lender Institution Escrow";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Reconciliation Cashout Bank BRI Manual Lender Institution Escrow";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanReconciliationCashoutBRIInstitution");
}

rule TransformAcuanTransactionCommitmentLetterIisLowerThanActual "When acuan transaction type is Commitment letter < Actual Receipt of Funds from Institutional Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPIK"
    then
        JournalDebit1.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Commitment letter < Actual Receipt of Funds from Institutional Lender";
        JournalDebit1.Amount = Acuan.Amount;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Commitment letter < Actual Receipt of Funds from Institutional Lender";
        JournalCredit1.Amount = Acuan.Amount;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionCommitmentLetterIisLowerThanActual");
}

rule TransformAcuanTransactionApprovalBankBriManualLenderInstitutionEscrow "When acuan transaction type is Approval Bank BRI Manual Lender Institution Escrow, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTAE"
    then
        JournalDebit1.Account = Transaction.GetByAccountNumberAltIDLegacyID(Acuan.GetAccountNumber());
        JournalDebit1.Narrative = "Approval Bank BRI Manual Lender Institution Escrow";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Approval Bank BRI Manual Lender Institution Escrow";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionApprovalBankBriManualLenderInstitutionEscrow");
}

rule TransformAcuanTransactionTopUpLenderViaVABRI "When acuan transaction type is Top Up Lender via VA BRI, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVI" && !Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = "114001000000009";
        JournalDebit1.Narrative = "Top Up Lender via VA BRI";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via VA BRI";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpLenderViaVABRI");
}

rule TransformAcuanTransactionTopUpLenderViaVABRIWithFlagOJK "When acuan transaction type is Top Up Lender via VA BRI, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPVI" && Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByEntityInMeta(Acuan);
        JournalDebit1.Narrative = "Top Up Lender via VA BRI";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via VA BRI";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpLenderViaVABRIWithFlagOJK");
}

rule TransformAcuanMoneyFlowTopUpLenderMidtrans "When acuan transaction type is Money Flow Top Up Lender from Midtrans, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPLW"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Money Flow Top Up Lender from Midtrans";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "145001000000002";
        JournalCredit1.Narrative = "Money Flow Top Up Lender from Midtrans";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanMoneyFlowTopUpLenderMidtrans");
}

rule TransformAcuanTopUpLenderViaVA "When acuan transaction type is Top Up Lender via VA, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPLF"
    then
        JournalDebit1.Account = "145001000000002";
        JournalDebit1.Narrative = "Top Up Lender via VA";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender via VA";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTopUpLenderViaVA");
}

rule TransformAcuanTransactionCommitmentLetterIisBiggerThanActual "When acuan transaction type is Cashout for lender piutang: Commitment letter > Actual Receipt of Funds from Institutional Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPIL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Cashout for lender piutang: Commitment letter > Actual Receipt of Funds from Institutional Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetReceivableAccountNumber(Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Cashout for lender piutang: Commitment letter > Actual Receipt of Funds from Institutional Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionCommitmentLetterIisBiggerThanActual");
}

rule TransformAcuanTransactionActualReceiptOfFundsFromInstitutionalLender "When acuan transaction type is Actual Receipt of Funds from Institutional Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPIP"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Actual Receipt of Funds from Institutional Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetReceivableAccountNumber(Acuan.Description);
        JournalCredit1.Narrative = "Actual Receipt of Funds from Institutional Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionActualReceiptOfFundsFromInstitutionalLender");
}

rule TransformAcuanTransactionAmarthaTopUpRepresentInstitutionalLender "When acuan transaction type is Amartha Top Up represent Institutional Lender, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "TUPIN"
    then
        JournalDebit1.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Amartha Top Up represent Institutional Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Amartha Top Up represent Institutional Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAmarthaTopUpRepresentInstitutionalLender");
}

rule TransformAcuanTransactionTopUpEarnByANR "When acuan transaction type is Top Up Earn by ANR, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "TUPEN"
    then
        JournalDebit1.Account = "114001000000009";
        JournalDebit1.Narrative = "Topup for Deposit Debt";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Topup for Deposit Debt";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpEarnByANR");
}

rule TransformAcuanTransactionTransferStopInvestmentEarnToPoket "When acuan transaction type is Transfer Stop Investment Earn to Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "SIVEP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer fund for Divest Earn " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1203200031000";
        JournalCredit1.Narrative = "Transfer fund for Divest Earn " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "IDR1105200032000";
        JournalDebit2.Narrative = "Receive fund from Divest Earn " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Receive fund from Divest Earn " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTransferStopInvestmentEarnToPoket");
}

rule TransformAcuanTransactionStopInvestmentEarn "When acuan transaction type is Stop Investment Earn, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "SIVEA"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionStopInvestmentEarn");
}

rule TransformAcuanTransactionRefundToEarnAccount "When acuan transaction type is Refund to Earn Account, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DBFEA"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund from Failed Disbursement Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund from Failed Disbursement Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundToEarnAccount");
}

rule TransformAcuanTransactionMoneyFlowTopUpEarnViaPoket "When acuan transaction type is Money Flow Top Up Earn via Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFFEP"
    then
        JournalDebit1.Account = "IDR1203200032000";
        JournalDebit1.Narrative = "Moneyflow Topup Earn";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Topup Earn";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Topup Earn";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "222000000000";
        JournalCredit2.Narrative = "Moneyflow Topup Earn";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowTopUpEarnViaPoket");
}

rule TransformAcuanTransactionMoneyFlowStopInvestEarnToPoket "When acuan transaction type is Money Flow Stop Invest Earn to Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMRP"
    then
        JournalDebit1.Account = "IDR1203200031000";
        JournalDebit1.Narrative = "Moneyflow Divest Earn";
        Journal.Transactions.Append(JournalDebit1);
        
        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Divest Earn";
        Journal.Transactions.Append(JournalCredit1);
        
        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Divest Earn";
        Journal.Transactions.Append(JournalDebit2);
        
        JournalCredit2.Account = "IDR1105200032000";
        JournalCredit2.Narrative = "Moneyflow Divest Earn";
        Journal.Transactions.Append(JournalCredit2);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowStopInvestEarnToPoket");
}

rule TransformAcuanTransactionDepositAdminFeeBudget "When acuan transaction type is Deposit Admin Fee Budget, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPFE"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = "Deposit Admin Fee from Operational";
        Journal.Transactions.Append(JournalDebit1);
        
        JournalCredit1.Account = "IDR1104100012000";
        JournalCredit1.Narrative = "Deposit Admin Fee from Operational";
        Journal.Transactions.Append(JournalCredit1);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositAdminFeeBudget");
}

rule TransformAcuanTransactionMoneyFlowTopUpViaMidtrans "When acuan transaction type is Money Flow Top Up via Midtrans, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPWD"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = "Moneyflow Top Up via Midtrans";
        Journal.Transactions.Append(JournalDebit1);
        
        JournalCredit1.Account = "IDR1105200042000";
        JournalCredit1.Narrative = "Moneyflow Top Up via Midtrans";
        Journal.Transactions.Append(JournalCredit1);
        
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowTopUpViaMidtrans");
}

rule TransformAcuanTransactionTopUpLenderBankToRespectiveBankAccount "When acuan transaction type is Top Up Lender Bank to Respective Bank Account, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "TUPBA"
    then
        JournalDebit1.Account = Transaction.GetByAccountNumberAltIDLegacyID(Acuan.GetDebitAccountInMeta());
        JournalDebit1.Narrative = "Top Up Lender Bank to Respective Bank Account";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender Bank to Respective Bank Account";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpLenderBankToRespectiveBankAccount");
}

rule TransformAcuanTransactionForwardRepaymentLenderProfitGroupNormalLoan "When acuan transaction type is forward repayment - lender profit group loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderProfitGroupNormalLoan");
}

rule TransformAcuanTransactionFailedDisbursementLenderInvestment "When acuan transaction type is Failed Disbursement Lender Investment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DBFAA"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund from Failed Disbursement Loan " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund from Failed Disbursement Loan " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFailedDisbursementLenderInvestment");
}

rule TransformAcuanTransactionRefundInvestment "When acuan transaction type is Refund Investment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDMT"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Investment Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Investment Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundInvestment");
}

rule TransformAcuanTransactionH2HCashOutPoket "When acuan transaction type is H2H Cash Out Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTPR"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "H2H Cash Out Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "230001713145";
        JournalCredit1.Narrative = "H2H Cash Out Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionH2HCashOutPoket");
}

rule TransformAcuanTransactionAdminFeeForIntegrationWithExternalSystem "When acuan transaction type is Admin Fee for Integration with External System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMFE" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetAccountByEntityCreditPASProd();
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeForIntegrationWithExternalSystem");
}

rule TransformAcuanTransactionAdminFeeForIntegrationWithExternalSystemSplitEscrow "When acuan transaction type is Admin Fee for Integration with External System for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMFE" && (Acuan.GetAccountNumberBank() != "") && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetAccountNumberBank();
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeForIntegrationWithExternalSystemSplitEscrow");
}

rule TransformAcuanTransactionAdminFeeForIntegrationWithExternalSystemMultifinance "When acuan transaction type is Admin Fee for Integration with External System for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMFE" && (Acuan.GetAccountNumberBank() == "") && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByEntityInMeta(Acuan);
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeForIntegrationWithExternalSystemMultifinance");
}

rule TransformAcuanTransactionPoketInternalTransfer "When acuan transaction type is Poket Internal Transfer, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ITRTF" && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        Journal = Transaction.TransformPoketInternalTransfer(Acuan,Journal);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPoketInternalTransfer");
}

rule TransformAcuanTransactionPoketInternalTransferNormal "When acuan transaction type is Poket Internal Transfer, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ITRTF"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPoketInternalTransferNormal");
}

rule TransformAcuanTransactionReversal "When acuan transaction type is Reversal, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "RVRSL"
    then
        Journal = Transaction.TransformReversalTransaction(Acuan,Journal);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReversal");
}

rule TransformAcuanTransactionReversalViaUploadAcuan "When acuan transaction type is Reversal via upload from acuan, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "RFDTX"
    then
        Journal = Transaction.TransformReversalTransactionViaUploadAcuan(Acuan,Journal);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReversalViaUploadAcuan");
}

rule TransformAcuanTransactionReversalMigration "When acuan transaction type is Reversal for migration, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "RFDTF"
    then
        Journal = Transaction.TransformReversalTransactionViaUploadAcuan(Acuan,Journal);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReversalMigration");
}

rule TransformAcuanTransactionAdminFeeViaMidtrans13 "When acuan transaction type is admin fee via midtrans with scenario 1 and scenario 3, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMME" && (Scenario == 1 || Scenario == 3) && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByAccEntityAndTrxTypes(Acuan.SourceAccountId, Acuan.TransactionType.ToLower(), "credit");
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeViaMidtrans13");
}

rule TransformAcuanTransactionAdminFeeViaMidtrans2 "When acuan transaction type is admin fee via midtrans with scenario 2, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMME" && Scenario == 2 && Flag.IsEnabled("PAS-BE-internal-point-negative-balance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByAccEntityAndTrxTypes(Acuan.SourceAccountId, Acuan.TransactionType.ToLower(), "credit");
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeViaMidtrans2");
}

rule TransformAcuanTransactionAdminFeeViaMidtrans "When acuan transaction type is admin fee via midtrans, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMME"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByAccEntityAndTrxTypes(Acuan.SourceAccountId, Acuan.TransactionType.ToLower(), "credit");
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeViaMidtrans");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxGroupLoan "When acuan transaction type is forward repayment partner loan - lender tax income Group Loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxGroupLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaGroupLoan "When acuan transaction type is forward repayment partner loan - ppn amartha Group Loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaGroupLoan");
}

rule TransformAcuanTransactionPaymentModalByPoket "When acuan transaction type is Payment Modal by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYMD" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Repayment Modal via Poket " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanIDsInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261003000000001";
        JournalCredit1.Narrative = "Repayment Modal via Poket " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanIDsInMeta();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "143001000000002";
        JournalDebit2.Narrative = "Repayment Modal via Poket " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanIDsInMeta();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "121001000000006";
        JournalCredit2.Narrative = "Repayment Modal via Poket " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanIDsInMeta();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentModalByPoket");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxModal "When acuan transaction type is forward repayment partner loan - lender tax income modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "MODAL_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000006";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxModal");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaModal "When acuan transaction type is forward repayment partner loan - ppn amartha modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "MODAL_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000006";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaModal");
}

rule TransformAcuanTransactionAdminFeeTransferBank "When acuan transaction type is Admin Fee for Transfer to Bank, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMCE"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetAccountByEntityCreditPASProd();
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeTransferBank");
}

rule TransformAcuanTransactionMoneyflowPaymentModalByPoket "When acuan transaction type Moneyflow Payment Modal by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFFMD" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "261003000000001";
        JournalDebit1.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "230001713145";
        JournalCredit1.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "143001000000002";
        JournalCredit2.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowPaymentModalByPoket");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxPeldinModal "When acuan transaction type is forward repayment partner loan - lender tax income peldin modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.GetDebitAccount() == "IDR1001600041000" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxPeldinModal");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaPeldinModal "When acuan transaction type is forward repayment partner loan - interest amartha peldin modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.GetDebitAccount() == "IDR1001600041000" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaPeldinModal");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaPeldinModal "When acuan transaction type is forward repayment partner loan - ppn amartha peldin modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.GetDebitAccount() == "IDR1001600041000" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaPeldinModal");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNGraduation "When acuan transaction type is forward repayment partner loan - ppn amartha graduation, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "GRADUATION_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "IDR1001600021000";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNGraduation");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNEfishery "When acuan transaction type is forward repayment partner loan - ppn amartha efishery, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000009";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNEfishery");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNModalPaylaterLoan "When acuan transaction type is forward repayment partner loan - ppn amartha modal paylater loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "MODAL_PAYLATER_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000012";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNModalPaylaterLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderProfitPeldinModal "When acuan transaction type is forward repayment partner loan - lender profit peldin modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.GetDebitAccount() == "IDR1001600041000" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderProfitPeldinModal");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionPeldinModal "When acuan transaction type is forward repayment partner loan - loan deduction peldin modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.GetDebitAccount() == "IDR1001600041000" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionPeldinModal");
}

rule TransformAcuanTransactionReversalPaymentPPOBCOGSPoket "When acuan transaction type is Reversal Payment PPOB COGS by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDPC"
    then
        JournalDebit1.Account = "IDR1701000012000";
        JournalDebit1.Narrative = "Refund Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReversalPaymentPPOBCOGSPoket");
}

rule TransformAcuanTransactionRefundDeposit "When acuan transaction type is RefundDeposit, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDPP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund unused provision fund back to provision deposit account";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund unused provision fund back to provision deposit account";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundDeposit");
}

rule TransformAcuanTransactionPartialRefund "When acuan transaction type is PartialRefund, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDQR"
    then
        JournalDebit1.Account = "261003000000010";
        JournalDebit1.Narrative = "Partial refund for transaction " + Acuan.RefNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Partial refund for transaction " + Acuan.RefNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPartialRefund");
}

rule TransformAcuanTransactionReversalPaymentPPOBRevenuePoket "When acuan transaction type is Reversal Payment PPOB Revenue by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDPR"
    then
        JournalDebit1.Account = "IDR1218600012000";
        JournalDebit1.Narrative = "Reversal Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Reversal Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReversalPaymentPPOBRevenuePoket");
}

rule TransformAcuanTransactionPaymentGroupLoanPoket "When acuan transaction type is Payment Group Loan by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYGL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Repayment Group Loan via Poket " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1203200022000";
        JournalCredit1.Narrative = "Repayment Group Loan via Poket " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "IDR1201000011000";
        JournalDebit2.Narrative = "Repayment Group Loan via Poket " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "121001000000008";
        JournalCredit2.Narrative = "Repayment Group Loan via Poket " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentGroupLoanPoket");
}

rule TransformAcuanTransactionMoneyflowPaymentGroupLoanPoket "When acuan transaction type is Moneyflow Payment Group Loan by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFFGL"
    then
        JournalDebit1.Account = "IDR1203200022000";
        JournalDebit1.Narrative = "Fund transfer Repayment Group Loan to AMF";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Fund transfer Repayment Group Loan to AMF";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Receipt of Repayment Money Group Loan from Poket";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "IDR1201000011000";
        JournalCredit2.Narrative = "Receipt of Repayment Money Group Loan from Poket";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowPaymentGroupLoanPoket");
}

rule TransformAcuanTransactionDepositOperationalBudget "When it's deposit operational budget, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMOB"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositOperationalBudget");
}

rule TransformAcuanTransactionGeneralCashIn "When it's general cash in, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPGE"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative =  Acuan.Description + "-" + Acuan.GetNotesInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative =  Acuan.Description + "-" + Acuan.GetNotesInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionGeneralCashIn");
}

rule TransformAcuanTransactionDisbursementPLGroupLoan "When it's disbursement partnership loan group loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" &&
        (Acuan.GetProductType() == "group loan" || Acuan.Description == "DISB NORMAL") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "IDR1001600011000";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLGroupLoan");
}

rule TransformAcuanTransactionDisbursementOutstandingPLGroupLoan "When it's disbursement outstanding partnership loan modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1001600011000";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLGroupLoan");
}

rule TransformAcuanTransactionEarnDeduction "When it's Earn Deduction, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBED" &&
        Acuan.Description != "MIGRATION"
    then
        JournalDebit1.Account = "IDR1001600011000";
        JournalDebit1.Narrative = "Topup Earn from Deduction Disburse Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Topup Earn from Deduction Disburse Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionEarnDeduction");
}

rule TransformAcuanTransactionLebaranDeduction "When it's Lebaran Deduction, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBLD" &&
        Acuan.Description != "MIGRATION"
    then
        JournalDebit1.Account = "IDR1001600011000";
        JournalDebit1.Narrative = "Advance Payment from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Advance Payment from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionLebaranDeduction");
}

rule TransformAcuanTransactionMoneyFlowPaymentPPOBByPoket "When acuan transaction type is Money flow Payment PPOB by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFNPC"
    then
        JournalDebit1.Account = "IDR1701000012000";
        JournalDebit1.Narrative = "Money flow Payment PPOB by Poket to ANR";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Money flow Payment PPOB by Poket to ANR";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowPaymentPPOBByPoket");
}

rule TransformAcuanTransactionMoneyFlowPaymentRevenuePPOBByPoket "When acuan transaction type is Money flow Payment Revenue PPOB by Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFNPR"
    then
        JournalDebit1.Account = "IDR1218600012000";
        JournalDebit1.Narrative = "Money flow Payment PPOB by Poket to ANR";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Money flow Payment PPOB by Poket to ANR";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowPaymentRevenuePPOBByPoket");
}

rule TransformAcuanTransactionRealizationPlatformFeeRevenueToOnBS "When acuan transaction type is Realization Platform Fee Revenue to On BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWRP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default2", Acuan.SourceAccountId);
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRealizationPlatformFeeRevenueToOnBS");
}

rule TransformAcuanTransactionRealizationPlatformFeeVATOutToOnBS "When acuan transaction type is Realization Platform Fee VAT Out to On BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWRQ"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default2", Acuan.SourceAccountId);
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRealizationPlatformFeeVATOutToOnBS");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionNormal "When it's platform/admin fee revenue portion, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "IDR1001600011000";
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionNormal");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionBroilerxLoan "When it's platform/admin fee revenue portion with description BROILERX_LOAN, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000001";
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionBroilerxLoan");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionChickinLoan "When it's platform/admin fee revenue portion with description CHICKIN_LOAN, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000002";
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionChickinLoan");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionNormal "When it's platform/admin fee vat out portion when description is NORMAL, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "NORMAL" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "IDR1001600011000";
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionNormal");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionBroilerxLoan "When it's platform/admin fee vat out portion when description is BROILERX_LOAN, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "BROILERX_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000001";
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionBroilerxLoan");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionChickinLoan "When it's platform/admin fee vat out portion when description is CHICKIN_LOAN, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "CHICKIN_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000002";
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionChickinLoan");
}

rule TransformAcuanTransactionPaymentPPOBByPoket "When it's payment ppob by poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYPC"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1701000012000";
        JournalCredit1.Narrative = "Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentPPOBByPoket");
}

rule TransformAcuanTransactionRevenuePPOBByPoket "When it's revenue ppob by poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYPR"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1218600012000";
        JournalCredit1.Narrative = "Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRevenuePPOBByPoket");
}

rule TransformAcuanTransactionSubmissionTaskRepayment "When it's submission task repayment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYTR"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment Fund " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000008";
        JournalCredit1.Narrative = "Repayment Fund " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionSubmissionTaskRepayment");
}

rule TransformAcuanTransactionBMValidation "When it's BM validation, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYBV"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment Fund " + Acuan.GetRepaymentDate() + " from BP to BM";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Repayment Fund " + Acuan.GetRepaymentDate() + " from BP to BM";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBMValidation");
}

rule TransformAcuanTransactionBMDepositToVA "When it's BM deposit money to VA, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYVA"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment Fund " + Acuan.GetRepaymentDate() + " from BM to VA " + Acuan.GetVAPoint();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Repayment Fund " + Acuan.GetRepaymentDate() + " from BM to VA " + Acuan.GetVAPoint();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBMDepositToVA");
}

rule TransformAcuanTransactionMoneyFlowBankFO "When acuan transaction type is money flow to bank FO, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBBA"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Channeling funds to Bank FO";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Channeling funds to Bank FO";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowBankFO");
}

rule TransformAcuanTransactionBMWithdrawBankFO "When acuan transaction type is BM withdraw from bank FO, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBBB"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Withdrawal Disbursement funds from Bank FO";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Withdrawal Disbursement funds from Bank FO";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBMWithdrawBankFO");
}

rule TransformAcuanTransactionBMToBP "When acuan transaction type is BM to BP, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBBC"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Disbursement Funds from BM to BP";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Disbursement Funds from BM to BP";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBMToBP");
}

rule TransformAcuanTransactionDisburseToBorrower "When acuan transaction type is disburse to borrower, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBBD"
    then
        JournalDebit1.Account = "IDR1001600011000";
        JournalDebit1.Narrative = "Moneyflow disbursement from BP to Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow disbursement from BP to Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisburseToBorrower");
}

rule TransformAcuanTransactionPeldinDeductionIntraCompany "When acuan transaction type is peldin deduction Intra Company, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBPD" &&
        Acuan.Description != "MIGRATION" &&
        Acuan.GetNewEntityLoanAccountNumber() == Acuan.GetOldEntityLoanAccountNumber()
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByEntityProductTypeTrxType(Acuan.GetNewLoanAccountNumber(), Acuan.GetNewEntityLoanAccountNumber(), Acuan.TransactionType.ToLower(), "debit");
        JournalDebit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByEntityProductTypeTrxType(Acuan.GetOldLoanAccountNumber(), Acuan.GetOldEntityLoanAccountNumber(), Acuan.TransactionType.ToLower(), "credit");
        JournalCredit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPeldinDeductionIntraCompany");
}

rule TransformAcuanTransactionPeldinDeductionInterCompanyAWFAMF "When acuan transaction type is peldin deduction Inter Company AWF to AMF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBPD" &&
        Acuan.Description != "MIGRATION" &&
        (Acuan.GetNewEntityLoanAccountNumber() == "005" && Acuan.GetOldEntityLoanAccountNumber() == "001")
    then
        JournalDebit1.Account = "143001000000012";
        JournalDebit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByEntityProductTypeTrxType(Acuan.GetOldLoanAccountNumber(), Acuan.GetOldEntityLoanAccountNumber(), Acuan.TransactionType.ToLower(), "credit");
        JournalCredit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Transaction.MultiGetAccountByEntityProductTypeTrxType(Acuan.GetNewLoanAccountNumber(), Acuan.GetNewEntityLoanAccountNumber(), Acuan.TransactionType.ToLower(), "debit");
        JournalDebit2.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "261005000000008";
        JournalCredit2.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPeldinDeductionInterCompanyAWFAMF");
}

rule TransformAcuanTransactionPeldinDeductionInterCompanyAMFAWF "When acuan transaction type is peldin deduction Inter Company AMF to AWF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBPD" &&
        Acuan.Description != "MIGRATION" &&
        (Acuan.GetNewEntityLoanAccountNumber() == "001" && Acuan.GetOldEntityLoanAccountNumber() == "005")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByEntityProductTypeTrxType(Acuan.GetNewLoanAccountNumber(), Acuan.GetNewEntityLoanAccountNumber(), Acuan.TransactionType.ToLower(), "debit");
        JournalDebit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261001000000009";
        JournalCredit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "143005000000011";
        JournalDebit2.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Transaction.MultiGetAccountByEntityProductTypeTrxType(Acuan.GetOldLoanAccountNumber(), Acuan.GetOldEntityLoanAccountNumber(), Acuan.TransactionType.ToLower(), "credit");
        JournalCredit2.Narrative = "Forward Early Repayment from Deduction Disburse Loan " + Acuan.GetNewLoanAccountNumber() + " to " + Acuan.GetOldLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPeldinDeductionInterCompanyAMFAWF");
}

rule TransformAcuanTransactionForwardRepaymentAdvancePayment "When acuan transaction type is Forward Repayment - Advance Payment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAH"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Advance Payment from Borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Advance Payment from Borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentAdvancePayment");
}

rule TransformAcuanTransactionForwardRepaymentLoanAdvanceDeduction "When acuan transaction type is Forward Repayment - Loan Advance Deduction, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAI"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Loan Advance Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000008";
        JournalCredit1.Narrative = "Loan Advance Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLoanAdvanceDeduction");
}

rule TransformAcuanTransactionWithdrawTopUpLenderViaXenditManualUpload "When acuan transaction type is Withdraw Top Up Lender via Xendit - manual upload, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPWX"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Withdraw Top Up Lender via Xendit";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "145001000000001";
        JournalCredit1.Narrative = "Withdraw Top Up Lender via Xendit";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionWithdrawTopUpLenderViaXenditManualUpload");
}

rule TransformAcuanTransactionWithdrawTopUpLenderViaMidtransManualUpload "When acuan transaction type is Withdraw Top Up Lender via Midtrans - manual upload, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPWM"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Withdraw Top Up Lender via Midtrans";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "145001000000002";
        JournalCredit1.Narrative = "Withdraw Top Up Lender via Midtrans";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionWithdrawTopUpLenderViaMidtransManualUpload");
}

rule TransformAcuanTransactionFailedDisbursementBPToBM "When acuan transaction type is Failed Disbursement BP To BM, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DBFAB"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Failed Disbursement " + Acuan.GetDisbursementDate() + " from BP to BM";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Failed Disbursement " + Acuan.GetDisbursementDate() + " from BP to BM";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFailedDisbursementBPToBM");
}

rule TransformAcuanTransactionFailedDisbursementBMDepositMoneyToVA "When acuan transaction type is Failed Disbursement BM deposit money to VA, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DBFAC"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Failed Disbursement " + Acuan.GetDisbursementDate() + " from BM to VA " + Acuan.GetVAPoint();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Failed Disbursement " + Acuan.GetDisbursementDate() + " from BM to VA " + Acuan.GetVAPoint();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFailedDisbursementBMDepositMoneyToVA");
}

rule TransformAcuanTransactionPaymentInsurancePremi "When acuan transaction type is Payment Insurance Premi, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSPL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Premium Funds by Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1208000011000";
        JournalCredit1.Narrative = "Premium Funds by Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentInsurancePremi");
}

rule TransformAcuanForwardingClaimToLender "When acuan transaction type is Forwarding Claim to Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSCL"
    then
        JournalDebit1.Account = "IDR1208500011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanForwardingClaimToLender");
}

rule TransformAcuanRefundInvestmentWithVoucher "When acuan transaction type is Refund Investment with Voucher, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDVO"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Invest Lender with Voucher";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Invest Lender with Voucher";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanRefundInvestmentWithVoucher");
}

rule TransformAcuanInvestmentWithVoucher "When acuan transaction type is Investment with Voucher, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INVVO"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Investment Lender with Voucher " + Acuan.GetVoucherCode() + " to Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Investment Lender with Voucher " + Acuan.GetVoucherCode() + " to Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanInvestmentWithVoucher");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionGraduationLoan "When acuan transaction type is forward repayment partner loan - loan deduction graduation loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "GRADUATION_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "IDR1001600021000";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionGraduationLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionEfisheryLoan "When acuan transaction type is forward repayment partner loan - loan deduction efishery loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000009";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionEfisheryLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionModalPaylaterLoan "When acuan transaction type is forward repayment partner loan - loan deduction modal paylater loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "MODAL_PAYLATER_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000012";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionModalPaylaterLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaGraduationLoan "When acuan transaction type is forward repayment partner loan - interest amartha graduation loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "GRADUATION_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "IDR1001600021000";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaGraduationLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaEfisheryLoan "When acuan transaction type is forward repayment partner loan - interest amartha efishery loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000009";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaEfisheryLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaModalPaylaterLoan "When acuan transaction type is forward repayment partner loan - interest amartha modal paylater loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "MODAL_PAYLATER_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000012";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaModalPaylaterLoan");
}

rule TransformAcuanTransactionForwardRepaymentLenderProfitGraduationLoan "When acuan transaction type is forward repayment - lender profit graduation loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "GRADUATION_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "IDR1001600021000";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderProfitGraduationLoan");
}

rule TransformAcuanTransactionForwardRepaymentLenderProfitEfisheryLoan "When acuan transaction type is forward repayment - lender profit efishery loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000009";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderProfitEfisheryLoan");
}

rule TransformAcuanTransactionForwardRepaymentLenderProfitModalPaylaterLoan "When acuan transaction type is forward repayment - lender profit modal paylater loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "MODAL_PAYLATER_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000012";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderProfitModalPaylaterLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxGraduationLoan "When acuan transaction type is forward repayment partner loan - lender tax income graduation loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "GRADUATION_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "IDR1001600021000";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxGraduationLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxEfisheryLoan "When acuan transaction type is forward repayment partner loan - lender tax income efishery loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000009";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxEfisheryLoan");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxModalPaylaterLoan "When acuan transaction type is forward repayment partner loan - lender tax income modal paylater loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "MODAL_PAYLATER_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000012";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxModalPaylaterLoan");
}

rule TransformAcuanForwardingClaimDeductLoan "When acuan transaction type is Forwarding Claim to Deduct Loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSDL"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanForwardingClaimDeductLoan");
}

rule TransformAcuanTakeoverInvestmentClaimLenderRemedial "When acuan transaction type is Takeover investment claim to Lender Remedial, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSLR"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTakeoverInvestmentClaimLenderRemedial");
}

rule TransformAcuanOutstandingDeductionCoveredByInsuranceLife "When acuan transaction type is Outstanding deduction covered by Insurance Life, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSLL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Paid off Claim (Life) for Outstanding Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetBorrowerClaimFromAltId(Acuan.GetLoanAccountNumber());
        JournalCredit1.Narrative = "Paid off Claim (Life) for Outstanding Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanOutstandingDeductionCoveredByInsuranceLife");
}

rule TransformAcuanReceiptInsuranceClaimInsurer "When acuan transaction type is Receipt of Insurance Claim from Insurer, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSCA"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Receipt Funds from Insurance Company";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1208500011000";
        JournalCredit1.Narrative = "Receipt Funds from Insurance Company";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanReceiptInsuranceClaimInsurer");
}

rule TransformAcuanReceiptHardcomplainAdvanceONBS "When acuan transaction type is Receipt of Hardcomplain Advance from ON BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSHN"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Receipt Funds from Operational for Hardcomplain Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1208500011000";
        JournalCredit1.Narrative = "Receipt Funds from Operational for Hardcomplain Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanReceiptHardcomplainAdvanceONBS");
}

rule TransformAcuanPaymentInsurancePremiAmarthaBudget "When acuan transaction type is Payment Insurance Premi from Amartha Budget, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSPA"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Pay Premium Lender with Amartha's Budget";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Pay Premium Lender with Amartha's Budget";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPaymentInsurancePremiAmarthaBudget");
}

rule TransformAcuanPaymentInsurancePremiLenderInsurer "When acuan transaction type is Payment Insurance Premi Lender to Insurer, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSPI"
    then
        JournalDebit1.Account = "IDR1208000011000";
        JournalDebit1.Narrative = "Pay Premium Lender with Lender's Budget";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Pay Premium Lender with Lender's Budget";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPaymentInsurancePremiLenderInsurer");
}

rule TransformAcuanPremiReplacementONBS "When acuan transaction type is Premi Replacement from ON BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "INSPN"
    then
        JournalDebit1.Account = "114001000000009";
        JournalDebit1.Narrative = "Receipt Funds from Operational for Premium Payment";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Receipt Funds from Operational for Premium Payment";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPremiReplacementONBS");
}

rule TransformAcuanTransactionRepaymentPLGraduationLoan "When acuan transaction type is repayment partner loan graduation loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        Acuan.Description == "GRADUATION REPAYMENT"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1001600021000";
        JournalCredit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentPLGraduationLoan");
}

rule TransformAcuanTransactionRepaymentPLEfishery "When acuan transaction type is repayment partner loan efishery, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        (Acuan.GetProductType() == "efishery" || Acuan.Description == "EFISHERY REPAYMENT")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000009";
        JournalCredit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentPLEfishery");
}

rule TransformAcuanTransactionAdminFee "When acuan transaction type is Admin Fee for Integration with External System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMFM"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetAccountByDescEntityCodeProd();
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFee");
}

rule TransformAcuanLoanChangesToWriteOff "When acuan transaction type is Loan Changes to Write Off, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "WOLLC"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Transfer loan WriteOff";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Transfer loan WriteOff";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanLoanChangesToWriteOff");
}

rule TransformAcuanTakeoverInvestmentWOToLenderWO "When acuan transaction type is Takeover Investment WO to Lender WO, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "WOLIL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTakeoverInvestmentWOToLenderWO");
}

rule TransformAcuanPeldinBailout "When acuan transaction type is Peldin Bailout, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "WOLPB"
    then
        JournalDebit1.Account = "IDR1105200011000";
        JournalDebit1.Narrative = "Bailout NPL for Manual Topup";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Bailout NPL for Manual Topup";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPeldinBailout");
}

rule TransformAcuanStopInvestFromOldLender "When acuan transaction type is Stop Invest from Old Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "BBLOL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanStopInvestFromOldLender");
}

rule TransformAcuanBuybackFromNewLender "When acuan transaction type is Buyback from New Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "BBLNL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanBuybackFromNewLender");
}

rule TransformAcuanTransactionTransferInterestEarnToPoket "When acuan transaction type is Transfer Interest Earn to Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ITDEP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer Interest Funds from Earn to Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1203200021000";
        JournalCredit1.Narrative = "Transfer Interest Funds from Earn to Poket";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "IDR1105200022000";
        JournalDebit2.Narrative = "Receive Funds from Investment Earn";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Receive Funds from Investment Earn";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTransferInterestEarnToPoket");
}

rule TransformAcuanTransactionMoneyFlowInterestEarnToPoket "When acuan transaction type is Money Flow Interest Earn to Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMEP"
    then
        JournalDebit1.Account = "IDR1203200021000";
        JournalDebit1.Narrative = "Moneyflow Repayment Earn";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Repayment Earn";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Repayment Earn";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "IDR1105200022000";
        JournalCredit2.Narrative = "Moneyflow Repayment Earn";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowInterestEarnToPoket");
}

rule TransformAcuanPenerusanPrincipalLender "When acuan transaction type is Penerusan Principal to Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYCO"
    then
        JournalDebit1.Account = "IDR1208800011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPenerusanPrincipalLender");
}

rule TransformAcuanReturnRepayment "When acuan transaction type is Return Repayment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYEN"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Return repayment when buyback happen";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Return repayment when buyback happen";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanReturnRepayment");
}

rule TransformAcuanPenerusanInterestLender "When acuan transaction type is Penerusan Interest to Lender, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYIO"
    then
        JournalDebit1.Account = "IDR1106400011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPenerusanInterestLender");
}

rule TransformAcuanTopupToPartnerOffSystem "When acuan transaction type is Topup to Partner Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPO"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1208800011000";
        JournalCredit1.Narrative = Acuan.Description;

        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTopupToPartnerOffSystem");
}

rule TransformAcuanRepaymentAmarthaOffSystem "When acuan transaction type is Repayment to Amartha Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYPO"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1106400011000";
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanRepaymentAmarthaOffSystem");
}

rule TransformAcuanPenerusanRevenueAmartha "When acuan transaction type is Penerusan Revenue Amartha, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYRO"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPenerusanRevenueAmartha");
}

rule TransformAcuanTransactionForwardRepaymentRoundingPayment "When acuan transaction type is forward repayment rounding payment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAJ"
    then
        JournalDebit1.Account = "121001000000008";
        JournalDebit1.Narrative = "Rounding repayment from " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Rounding repayment from " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentRoundingPayment");
}

rule TransformAcuanGeneralTransactionsToBankPoint "When acuan transaction type is General Transactions to Bank Point, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMPT"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Receipt Funds from Other Transaction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.Description;
        JournalCredit1.Narrative = "Receipt Funds from Other Transaction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanGeneralTransactionsToBankPoint");
}

rule TransformAcuanGeneralTransactionsFromBankPoint "When acuan transaction type is General Transactions from Bank Point, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMPF"
    then
        JournalDebit1.Account = Acuan.Description;
        JournalDebit1.Narrative = "Withdrawal funds by BM";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Withdrawal funds by BM";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanGeneralTransactionsFromBankPoint");
}

rule TransformAcuanTalanganRepaymentFraud "When acuan transaction type is Talangan for Repayment Fraud, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMRF"
    then
        JournalDebit1.Account = "IDR1208400011000";
        JournalDebit1.Narrative = "Transfer funds for Bailout Fraud";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Transfer funds for Bailout Fraud";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTalanganRepaymentFraud");
}

rule TransformAcuanDisbursementToPartnerOffSystem "When acuan transaction type is Disbursement to Partner Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBPO"
    then
        JournalDebit1.Account = "IDR1106400011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;

        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanDisbursementToPartnerOffSystem");
}

rule TransformAcuanAdminFeeOfPartnershipLoanOffSystem "When acuan transaction type is Admin Fee of Partnership Loan Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAO"
    then
        JournalDebit1.Account = "IDR1106400011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanAdminFeeOfPartnershipLoanOffSystem");
}

rule TransformAcuanTransactionReimbursementVoucherInvestment "When acuan transaction type is Reimbursement Voucher Investment, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMVI"
    then
        JournalDebit1.Account = Acuan.Description;
        JournalDebit1.Narrative = "Receipt Funds from Operational for Marketing Voucher";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Receipt Funds from Operational for Marketing Voucher";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReimbursementVoucherInvestment");
}

rule TransformAcuanTransactionReimbursementAdminFee "When acuan transaction type is Reimbursement Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMRA"
    then
        JournalDebit1.Account = Acuan.Description;
        JournalDebit1.Narrative = "Receipt Funds from Operational for Bank Administrative - " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Receipt Funds from Operational for Bank Administrative - " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReimbursementAdminFee");
}

rule TransformAcuanTransactionTransferPettyCash "When acuan transaction type is Transfer Petty Cash, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMTP"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Receipt Funds from Operational for Petty Cash Point";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1208300011000";
        JournalCredit1.Narrative = "Receipt Funds from Operational for Petty Cash Point";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTransferPettyCash");
}

rule TransformAcuanTransactionWithdrawPettyCash "When acuan transaction type is Withdraw Petty Cash, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMWP"
    then
        JournalDebit1.Account = "IDR1208300011000";
        JournalDebit1.Narrative = "Petty Cash Withdrawal by BM";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Petty Cash Withdrawal by BM";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionWithdrawPettyCash");
}

rule TransformAcuanTransactionGeneralFundTransfer "When acuan transaction type is General Fund Transfer, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMPB"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionGeneralFundTransfer");
}

rule TransformAcuanTransactionBankInterest "When acuan transaction type is Bank Interest, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMBI"
    then
        JournalDebit1.Account = Acuan.Description;
        JournalDebit1.Narrative = "Interest fee from Bank Administration - " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Interest fee from Bank Administration - " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBankInterest");
}

rule TransformAcuanTransactionBankTax "When acuan transaction type is Bank Tax, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMBT"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Tax of Interest fee from Bank Administration - " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.Description;
        JournalCredit1.Narrative = "Tax of Interest fee from Bank Administration - " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBankTax");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionEfishery "When it's platform/admin fee vat out portion when description is Efishery, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000007";
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionEfishery");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionAgriaku "When it's platform/admin fee vat out portion when description is Agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000016";
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionAgriaku");
}

rule TransformAcuanTransactionDisbursementPLEfishery "When it's disbursement partnership loan efishery, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" &&
        (Acuan.GetProductType() == "efishery" || Acuan.Description == "DISB EFISHERY") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000007";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLEfishery");
}

rule TransformAcuanTransactionDisbursementOutstandingPLEfishery "When it's disbursement outstanding partnership loan efishery, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000007";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLEfishery");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionEfishery "When it's platform/admin fee revenue portion with description Efishery, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "EFISHERY_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000007";
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionEfishery");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionAgriaku "When it's platform/admin fee revenue portion for Agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = "121001000000016";
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.WalletTransaction.AccountNumber;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionAgriaku");
}

rule TransformAcuanTransactionDepositCashbackBudget "When acuan transaction type is Deposit Cashback Budget, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMCB"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = "Transfer Deposit Cashback from ANR/AFA ON BS";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer Deposit Cashback from ANR/AFA ON BS";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositCashbackBudget");
}

rule TransformAcuanTransactionPromotionCashback "When acuan transaction type is Promotion Cashback, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PRMCB"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forward Cashback to Mitra";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forward Cashback to Mitra";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPromotionCashback");
}

rule TransformAcuanTransactionRefundBudgetCashback "When acuan transaction type is Refund Budget Cashback, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDCB"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Budget Cashback";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "230001713145";
        JournalCredit1.Narrative = "Refund Budget Cashback";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundBudgetCashback");
}

rule TransformAcuanTransactionRefundIssueDeductionModal "When acuan transaction type is Refund issue deduction modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDMD" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000005";
        JournalDebit1.Narrative = "Refund Disburse Modal to Borrower " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Refund Disburse Modal to Borrower " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundIssueDeductionModal");
}

rule TransformAcuanTransactionRefundIssueDeductionModalMultifinance "When acuan transaction type is Refund issue deduction modal multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDMD" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.SourceAccountId);
        JournalDebit1.Narrative = "Refund Disburse Modal to Borrower " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Refund Disburse Modal to Borrower " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundIssueDeductionModalMultifinance");
}

rule TransformAcuanTransactionPaymentPaylaterViaMidtrans "When acuan transaction type is Payment Paylater via Midtrans, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYPM"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Received Payment from Midtrans";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000012";
        JournalCredit1.Narrative = "Received Payment from Midtrans";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentPaylaterViaMidtrans");
}

rule TransformAcuanTransactionWithdrawFromMidtrans "When acuan transaction type is Withdraw from Midtrans, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYWM"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Withdraw Payment from Midtrans";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Withdraw Payment from Midtrans";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionWithdrawFromMidtrans");
}

rule TransformAcuanTransactionRepaymentManualCollection "When acuan transaction type is Repayment Manual Collection, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYMC"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment for Loan Discount";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("NORMAL", Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Repayment for Loan Discount";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentManualCollection");
}

rule TransformAcuanPPHDeductionFromMonthlyInterest "When acuan transaction type is Admin Fee of Partnership Loan Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ITDPH"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Deduct PPH 23 from Interest Fee";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deduct PPH 23 from Interest Fee";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanPPHDeductionFromMonthlyInterest");
}

rule TransformAcuanForwardPrincipalToPoket "When acuan transaction type is Admin Fee of Partnership Loan Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "FPEPT"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forward principal from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261001000000002";
        JournalCredit1.Narrative = "Forward principal from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "143003000000006";
        JournalDebit2.Narrative = "Forward principal from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Forward principal from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanForwardPrincipalToPoket");
}

rule TransformAcuanMoneyflowForwardPrincipalToPoket "When acuan transaction type is Admin Fee of Partnership Loan Off System, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMPP"
    then
        JournalDebit1.Account = "261001000000002";
        JournalDebit1.Narrative = "Moneyflow Forward Principal Earn";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Forward Principal Earn";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Forward Principal Earn";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "143003000000006";
        JournalCredit2.Narrative = "Moneyflow Forward Principal Earn";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanMoneyflowForwardPrincipalToPoket");
}

rule TransformAcuanCashoutNoMoneyFlow "When acuan transaction type is Cashout No Money Flow, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTMF"
    then
        JournalDebit1.Account = "211001000000001";
        JournalDebit1.Narrative = "Cashout for lender piutang: Commitment letter > Actual Receipt of Funds from Institutional Lender";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Cashout for lender piutang: Commitment letter > Actual Receipt of Funds from Institutional Lender";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanCashoutNoMoneyFlow");
}

rule TransformAcuanBuyBackLoanDebtToDebt "When acuan transaction type is Buy Back Loan Debt to Debt, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "BBLDN"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanBuyBackLoanDebtToDebt");
}

rule TransformAcuanTransactionTopupLenderTelkomselVABRI "When acuan transaction type is Top Up Lender Telkomsel via VA BRI, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "TUPTI" && !Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = "114001000000009";
        JournalDebit1.Narrative = "Top Up Lender Telkomsel via VA BRI";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender Telkomsel via VA BRI";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalDebit2.Narrative = "Bailout Top Up for Portion Telkomsel";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "114001000000041";
        JournalCredit2.Narrative = "Bailout Top Up for Portion Telkomsel";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderTelkomselVABRI");
}

rule TransformAcuanTransactionTopupLenderTelkomselVABRIWithFlagOJK "When acuan transaction type is Top Up Lender Telkomsel via VA BRI, transform to transaction PAS"  salience 10 {
    when
        Acuan.TransactionType == "TUPTI" && Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = "114001000000053";
        JournalDebit1.Narrative = "Top Up Lender Telkomsel via VA BRI";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Lender Telkomsel via VA BRI";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Transaction.GetReceivableAccountNumber(Acuan.DestinationAccountId);
        JournalDebit2.Narrative = "Bailout Top Up for Portion Telkomsel";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "114001000000041";
        JournalCredit2.Narrative = "Bailout Top Up for Portion Telkomsel";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLenderTelkomselVABRIWithFlagOJK");
}

rule TransformAcuanTransactionDisbursementOutstandingModalPaylaterLoan "When it's disbursement outstanding partnership modal paylater loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "MODAL_PAYLATER_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000011";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingModalPaylaterLoan");
}

rule TransformAcuanTransactionDisbursementBRITelkomsel "When it's Disbursement to BRI Telkomsel, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBTI"
    then
        JournalDebit1.Account = "121001000000011";
        JournalDebit1.Narrative = "Channeling funds to borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Channeling funds to borrower";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "114001000000041";
        JournalDebit2.Narrative = "Payment fot Bailout Top Up Telkomsel";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "142001000000132";
        JournalCredit2.Narrative = "Payment fot Bailout Top Up Telkomsel";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementBRITelkomsel");
}

rule TransformAcuanTransactionPenerusanRevenueAmartha "When acuan transaction type is Penerusan Revenue Amartha, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAO"
    then
        JournalDebit1.Account = "IDR1106400011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPenerusanRevenueAmartha");
}

rule TransformAcuanTransactionReclassTypeLoanCloseOutstanding "When acuan transaction type is Reclass Type Loan - Close Outstanding, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "WOLLR"
    then
        JournalDebit1.Account = "IDR1208400011000";
        JournalDebit1.Narrative = "Close Old Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Close Old Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReclassTypeLoanCloseOutstanding");
}

rule TransformAcuanTransactionReclassTypeLoanCloseLendersAsset "When acuan transaction type is Reclass Type Loan - Close Lender's Asset, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "WOLAR"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Close Lender Asset";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1208400011000";
        JournalCredit1.Narrative = "Close Lender Asset";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReclassTypeLoanCloseLendersAsset");
}



rule TransformAcuanTransactionMoneyFlowWecareFromPoket "When it's Money flow Wecare From Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFFWC"
    then
        JournalDebit1.Account = "261003000000006";
        JournalDebit1.Narrative = "Moneyflow Payment WeCare via Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Payment WeCare via Poket";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowWecareFromPoket");
}

rule TransformAcuanTransactionTopUpWorkingCapitalCelengan "When it's Top Up Working Capital to Lender Celengan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPWC"
    then
        JournalDebit1.Account = "261001000000003";
        JournalDebit1.Narrative = "Forward Repayment Celengan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forward Repayment Celengan";
        Journal.Transactions.Append(JournalCredit1);
    
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpWorkingCapitalCelengan");
}

rule TransformAcuanTransactionCashoutWorkingCapitalCelengan "When it's Cash Out Working Capital from Lender Celengan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTWC"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Cashout Celengan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261001000000003";
        JournalCredit1.Narrative = "Cashout Celengan";
        Journal.Transactions.Append(JournalCredit1);
    
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionCashoutWorkingCapitalCelengan");
}

rule TransformAcuanTransactionMoneyFlowReturnWorkingCapitalCelengan "When it's Money Flow Working Capital Return from AMF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMWC"
    then
        JournalDebit1.Account = "261001000000003";
        JournalDebit1.Narrative = "Moneyflow for Return Advance Celengan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow for Return Advance Celengan";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow for Return Advance Celengan";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "IDR1104100012000";
        JournalCredit2.Narrative = "Moneyflow for Return Advance Celengan";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowReturnWorkingCapitalCelengan");
}

rule TransformAcuanTransactionDisburseOutstandingLoanRebook "When it's Disburse to Outstanding Loan Rebook, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBLR"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000013";
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);
    
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisburseOutstandingLoanRebook");
}

rule TransformAcuanTransactionTopupLoanRebook "When it's Transaction Top Up Loan Rebook, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPLR"
    then
        JournalDebit1.Account = "114001000000009";
        JournalDebit1.Narrative = "Forwarding funds for normal and VA top-up";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding funds for normal and VA top-up";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopupLoanRebook");
}

rule TransformAcuanTransactionMoneyFlowBorrowerLoanRebook "When it's Transaction Money Flow to Borrower Loan Rebook, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBMR"
    then
        JournalDebit1.Account = "121001000000013";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyFlowBorrowerLoanRebook");
}

rule TransformAcuanTransactionPPOBDiscount "When it's Transaction PPOB Discount, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYPD"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Deduct Deposit Discount for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deduct Deposit Discount for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBDiscount");
}

rule TransformAcuanTransactionPPOBVendorAdminFee "When it's Transaction PPOB Vendor Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYPV"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Deduct Deposit Voucherify for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1701000012000";
        JournalCredit1.Narrative = "Deduct Deposit Voucherify for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBVendorAdminFee");
}

rule TransformAcuanTransactionPPOBANRAdminFee "When it's Transaction PPOB ANR Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYFL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "ANR Admin Fee from Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "292003000000001";
        JournalCredit1.Narrative = "ANR Admin Fee from Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBANRAdminFee");
}

rule TransformAcuanTransactionPPOBAFAAdminFee "When it's Transaction PPOB AFA Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYFP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "AFA Admin Fee from Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "292003000000002";
        JournalCredit1.Narrative = "AFA Admin Fee from Payment PPOB by Poket - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBAFAAdminFee");
}

rule TransformAcuanTransactionPPOBDiscountANRAdminFee "When it's Transaction PPOB Discount ANR Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYDL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Deduct Deposit Discount for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deduct Deposit Discount for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBDiscountANRAdminFee");
}

rule TransformAcuanTransactionPPOBDiscountAFAAdminFee "When it's Transaction PPOB Discount AFA Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYDP"
    then
        JournalDebit1.Account = "141003000000002";
        JournalDebit1.Narrative = "Discount AFA Admin Fee for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Discount AFA Admin Fee for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBDiscountAFAAdminFee");
}

rule TransformAcuanTransactionRefundPPOBVendorPrice "When it's Transaction Refund PPOB Vendor Price, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDPD"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Discount Payment PPOB - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Discount Payment PPOB - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPPOBVendorPrice");
}

rule TransformAcuanTransactionRefundPPOBVendorAdminFee "When it's Transaction Refund PPOB Vendor Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDPV"
    then
        JournalDebit1.Account = "IDR1701000012000";
        JournalDebit1.Narrative = "Refund Vendor Admin Fee - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Vendor Admin Fee - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPPOBVendorAdminFee");
}

rule TransformAcuanTransactionRefundPPOBANRAdminFee "When it's Transaction Refund PPOB ANR Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDFL"
    then
        JournalDebit1.Account = "292003000000001";
        JournalDebit1.Narrative = "Refund ANR Admin Fee ANR - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund ANR Admin Fee ANR - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPPOBANRAdminFee");
}

rule TransformAcuanTransactionRefundPPOBAFAAdminFee "When it's Transaction Refund PPOB AFA Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDFP"
    then
        JournalDebit1.Account = "292003000000002";
        JournalDebit1.Narrative = "Refund AFA Admin Fee ANR - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund AFA Admin Fee ANR - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPPOBAFAAdminFee");
}

rule TransformAcuanTransactionRefundPPOBDiscountANRAdminFee "When it's Transaction Refund PPOB Discount ANR Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDDL"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Discount ANR Admin Fee - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Discount ANR Admin Fee - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPPOBDiscountANRAdminFee");
}

rule TransformAcuanTransactionRefundPPOBDiscountAFAAdminFee "When it's Transaction Refund PPOB Discount AFA Admin Fee, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDDP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Discount AFA Admin Fee - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "141003000000002";
        JournalCredit1.Narrative = "Refund Discount AFA Admin Fee - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPPOBDiscountAFAAdminFee");
}

rule TransformAcuanTransactionTopUpPoketViaBRIVAH2H "When it's Transaction Top Up Poket via BRIVA H2H, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPBH"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = "Top Up Poket/Internal Poket via BRIVA H2H";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Top Up Poket/Internal Poket via BRIVA H2H";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpPoketViaBRIVAH2H");
}

rule TransformAcuanTransactionDisbursementPLIndosat "When it's disbursement partnership loan Indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" &&
        (Acuan.GetProductType() == "indosat" || Acuan.Description == "DISB INDOSAT") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000014";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLIndosat");
}

rule TransformAcuanTransactionDisbursementPLAgriaku "When it's disbursement partnership loan Agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" &&
        (Acuan.GetProductType() == "agriaku" || Acuan.Description == "DISB AGRIAKU") && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "121001000000016";
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLAgriaku");
}

rule TransformAcuanTransactionDisbursementOutstandingPLIndosat "When it's disbursement outstanding partnership loan indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "INDOSAT_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000014";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLIndosat");
}

rule TransformAcuanTransactionDisbursementOutstandingPLAgriaku "When it's disbursement outstanding partnership loan Agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000016";
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLAgriaku");
}

rule TransformAcuanTransactionRepaymentPLIndosat "When acuan transaction type is repayment partner loan indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        (Acuan.GetProductType() == "indosat" || Acuan.Description == "INDOSAT REPAYMENT")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000015";
        JournalCredit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentPLIndosat");
}

rule TransformAcuanTransactionRepaymentPLAgriaku "When acuan transaction type is repayment partner loan agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        (Acuan.GetProductType() == "agriaku" || Acuan.Description == "AGRIAKU REPAYMENT")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "121001000000017";
        JournalCredit1.Narrative = "Repayment by partners/borrower";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentPLAgriaku");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderProfitIndosat "When acuan transaction type is forward repayment partner loan - lender profit indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "INDOSAT_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000015";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderProfitIndosat");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderProfitAgriaku "When acuan transaction type is forward repayment partner loan - lender profit agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000017";
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderProfitAgriaku");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxIndosat "When acuan transaction type is forward repayment partner loan - lender tax income indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "INDOSAT_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000015";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxIndosat");
}

rule TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxAgriaku "When acuan transaction type is forward repayment partner loan - lender tax income agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000017";
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLenderIncomeTaxAgriaku");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionIndosat "When acuan transaction type is forward repayment partner loan - loan deduction indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "INDOSAT_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000015";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionIndosat");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionAgriaku "When acuan transaction type is forward repayment partner loan - loan deduction agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000017";
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionAgriaku");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaIndosat "When acuan transaction type is forward repayment partner loan - interest amartha indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "INDOSAT_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000015";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaIndosat");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaAgriaku "When acuan transaction type is forward repayment partner loan - interest amartha agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000017";
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaAgriaku");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaIndosat "When acuan transaction type is forward repayment partner loan - ppn amartha indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "INDOSAT_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000015";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaIndosat");
}

rule TransformAcuanTransactionForwardRepaymentLateFeeIndosat "When acuan transaction type is forward repayment - late fee indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAK" &&
        Acuan.Description == "INDOSAT_LOAN"
    then
        JournalDebit1.Account = "121001000000015";
        JournalDebit1.Narrative = "Forwarding Late Fee";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding Late Fee";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLateFeeIndosat");
}

rule TransformAcuanTransactionRefundPeldinGLFromModalMultifinance "When it's Refund Peldin GL from Modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDMP" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "143003000000007";
        JournalDebit1.Narrative = "Refund Disburse Modal to Poket - Loan Modal " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Disburse Modal to Poket - Loan Modal " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "121001000000008";
        JournalDebit2.Narrative = "Refund Disburse Modal to Poket - Loan Modal " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "261001000000004";
        JournalCredit2.Narrative = "Refund Disburse Modal to Poket - Loan Modal " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPeldinGLFromModalMultifinance");
}

rule TransformAcuanTransactionRefundPeldinGLFromModal "When it's Refund Peldin GL from Modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDMP" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "143003000000007";
        JournalDebit1.Narrative = "Refund Disburse Modal to Poket " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Disburse Modal to Poket " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "121001000000005";
        JournalDebit2.Narrative = "Refund Disburse Modal to Poket " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "261001000000004";
        JournalCredit2.Narrative = "Refund Disburse Modal to Poket " + Acuan.GetLoanAccountNumberModal();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundPeldinGLFromModal");
}

rule TransformAcuanTransactionMoneyflowRefundPeldinGLFromModal "When it's Money Flow Refund Peldin GL from Modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMMP" && !Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "261001000000004";
        JournalDebit1.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "143003000000007";
        JournalCredit2.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowRefundPeldinGLFromModal");
}

rule TransformAcuanTransactionLateFeeFromLoanProductIndosat "When it's Late Fee from Loan Product Indosat, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWLF"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding late fee to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000009";
        JournalCredit1.Narrative = "Forwarding late fee to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionLateFeeFromLoanProductIndosat");
}

rule TransformAcuanTransactionDisbursementCashlessToBP "When it's Disbursement Cashless To BP, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBBE"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Disbursement Cashless to BP";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Disbursement Cashless to BP";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementCashlessToBP");
}

rule TransformAcuanTransactionInternalTransferCIHToPoket "When it's Internal Transfer CIH to Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ITRTP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Request Transfer CIH Lender to Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261001000000005";
        JournalCredit1.Narrative = "Request Transfer CIH Lender to Poket";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "143003000000008";
        JournalDebit2.Narrative = "Request Transfer CIH Lender to Poket";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.DestinationAccountId;
        JournalCredit2.Narrative = "Request Transfer CIH Lender to Poket";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionInternalTransferCIHToPoket");
}

rule TransformAcuanTransactionMoneyflowTransferCIHToPoket "When it's Money Flow Transfer CIH to Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMTP"
    then
        JournalDebit1.Account = "261001000000005";
        JournalDebit1.Narrative = "Moneyflow CIH Lender to Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow CIH Lender to Poket";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow CIH Lender to Poket";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "143003000000008";
        JournalCredit2.Narrative = "Moneyflow CIH Lender to Poket";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowTransferCIHToPoket");
}

rule TransformAcuanTransactionDisbursementOutstandingPLMigration "When it's disbursement outstanding partnership loan Migration, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" && 
        Acuan.Description == "MIGRATION"  
    then
        JournalDebit1.Account = Acuan.GetDebitAcctNo();
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditAcctNo();
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);
     
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLMigration");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionMigration "When it's platform/admin fee revenue portion with description Migration, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "MIGRATION"
    then
        JournalDebit1.Account = Acuan.GetDebitAcctNo();
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditAcctNo();
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionMigration");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionMigration "When it's platform/admin fee vat out portion when description is Migration, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "MIGRATION"
    then
        JournalDebit1.Account = Acuan.GetDebitAcctNo();
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionMigration");
}

rule TransformAcuanTransactionEarnDeductionMigration "When it's Earn Deduction for Migration, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBED" &&
        Acuan.Description == "MIGRATION"
    then
        JournalDebit1.Account = Acuan.GetDebitAcctNo();
        JournalDebit1.Narrative = "Topup Earn from Deduction Disburse Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditAcctNo();
        JournalCredit1.Narrative = "Topup Earn from Deduction Disburse Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionEarnDeductionMigration");
}

rule TransformAcuanTransactionLebaranDeductionMigration "When it's Lebaran Deduction for Migration, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBLD" &&
        Acuan.Description == "MIGRATION"
    then
        JournalDebit1.Account = Acuan.GetDebitAcctNo();
        JournalDebit1.Narrative = "Advance Payment from Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditAcctNo();
        JournalCredit1.Narrative = "Advance Payment from Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionLebaranDeductionMigration");
}

rule TransformAcuanTransactionPeldinDeductionMigration "When acuan transaction type is peldin deduction for Migration, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBPD" &&
        Acuan.Description == "MIGRATION"
    then
        JournalDebit1.Account = Acuan.GetDebitAcctNo();
        JournalDebit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditAcctNo();
        JournalCredit1.Narrative = "Forward Early Repayment from Deduction Disburse Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPeldinDeductionMigration");
}

rule TransformAcuanTransactionTopUpCelenganViaDanaInvestasi "When it's Transaction Top Up Celengan via Dana Investasi, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPED"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer CIH to CIH Celengan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer CIH to CIH Celengan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpCelenganViaDanaInvestasi");
}

rule TransformAcuanTransactionStopInvestmentDanaInvestasi "When it's Transaction Stop Investment to Dana Investasi, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "SIVED"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer fund for Divest Earn " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer fund for Divest Earn " + Acuan.GetLoanAccountNumber() + " - " + Acuan.GetLoanTypeInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionStopInvestmentDanaInvestasi");
}

rule TransformAcuanTransactionForwardPrincipalDanaInvestasi "When it's Transaction Forward Principal Dana Investasi, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "FPEPD"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forward principal from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forward principal from Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardPrincipalDanaInvestasi");
}

rule TransformAcuanTransactionTransferInterestEarnDanaInvestasi "When it's Transaction Transfer Interest Earn to Dana Investasi, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ITDED"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer Interest Funds from Earn to Dana Investasi";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transfer Interest Funds from Earn to Dana Investasi";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTransferInterestEarnDanaInvestasi");
}

rule TransformAcuanTransactionFeeRemittance "When it's Transaction Fee Remittance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMRV"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Admin Fee From Remittance via Agent " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "262003000000001";
        JournalCredit1.Narrative = "Admin Fee From Remittance via Agent " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFeeRemittance");
}

rule TransformAcuanTransactionDiscountRemittance "When it's Transaction Discount Remittance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMRD"
    then
        JournalDebit1.Account = "146003000000001";
        JournalDebit1.Narrative = "Discount From Fee Remittance " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Discount From Fee Remittance " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDiscountRemittance");
}

rule TransformAcuanTransactionDepositDigiasia "When it's Transaction Deposit Digiasia, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMDD"
    then
        JournalDebit1.Account = "143003000000009";
        JournalDebit1.Narrative = "Deposit Budget to Digiasia";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Deposit Budget to Digiasia";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositDigiasia");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAgriaku "When acuan transaction type is forward repayment partner loan - ppn agriaku, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.Description == "AGRIAKU_LOAN" && !Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = "121001000000017";
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAgriaku");
}

rule TransformAcuanTransactionPaymentFromPoket "When it's Payment from Poket, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYWC"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Payment " + Acuan.GetProductType() + " via Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261003000000006";
        JournalCredit1.Narrative = "Payment " + Acuan.GetProductType() + " via Poket";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentFromPoket");
}

rule TransformAcuanTransactionCashoutDigiasia "When acuan transaction type is Cashout Digiasia, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTDA"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Cashout Poket " + Acuan.SourceAccountId + " by Digiasia";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "143003000000009";
        JournalCredit1.Narrative = "Cashout Poket " + Acuan.SourceAccountId + " by Digiasia";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionCashoutDigiasia");
}

rule TransformAcuanTransactionAdminFeeDigiasia "When it's Transaction Admin Fee Digiasia, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMDA"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Admin Fee Digiasia";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "143003000000009";
        JournalCredit1.Narrative = "Admin Fee Digiasia";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeDigiasia");
}

rule TransformAcuanTransactionReceiptFundsDigiasia "When it's Transaction Receipt Funds from Operational for Admin Fee Digiasia, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMRP"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = "Receipt Funds from Operational for Admin Fee Digiasia";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Receipt Funds from Operational for Admin Fee Digiasia";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReceiptFundsDigiasia");
}

rule TransformAcuanTransactionAdjustmentFinance "When it's Transaction Adjustment Finance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADJAF"
    then
        JournalDebit1.Account = Acuan.GetDebitInMeta();
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditInMeta();
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdjustmentFinance");
}

rule TransformAcuanTransactionInterestMultifinance "When it's transaction interest for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWIT" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionInterestMultifinance");
}

rule TransformAcuanTransactionInterestMultifinanceWithFlagOJK "When it's transaction interest for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWIT" && (Acuan.GetSourceBankAccountInMeta() == "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default-ojk", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionInterestMultifinanceWithFlagOJK");
}

rule TransformAcuanTransactionInterestMultifinanceUsingSourceBank "When it's transaction interest for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWIT" && (Acuan.GetSourceBankAccountInMeta() != "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetSourceBankAccountInMeta();
        JournalCredit1.Narrative = "Forwarding revenue to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionInterestMultifinanceUsingSourceBank");
}

rule TransformAcuanTransactionPPNMultifinance "When it's transaction ppn for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPN" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPNMultifinance");
}

rule TransformAcuanTransactionPPNMultifinanceWithFlagOJK "When it's transaction ppn for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPN" && (Acuan.GetSourceBankAccountInMeta() == "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default-ojk", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPNMultifinanceWithFlagOJK");
}

rule TransformAcuanTransactionPPNMultifinanceUsingSourceBank "When it's transaction ppn for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPN" && (Acuan.GetSourceBankAccountInMeta() != "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetSourceBankAccountInMeta();
        JournalCredit1.Narrative = "Forwarding tax to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPNMultifinanceUsingSourceBank");
}

rule TransformAcuanTransactionPPHMultifinance "When it's transaction pph for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPH" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPHMultifinance");
}

rule TransformAcuanTransactionPPHMultifinanceWithFlagOJK "When it's transaction pph for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPH" && (Acuan.GetSourceBankAccountInMeta() == "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default-ojk", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPHMultifinanceWithFlagOJK");
}

rule TransformAcuanTransactionPPHMultifinanceUsingSourceBank "When it's transaction pph for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWPH" && (Acuan.GetSourceBankAccountInMeta() != "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetSourceBankAccountInMeta();
        JournalCredit1.Narrative = "Forwarding income tax (Article 23) to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPHMultifinanceUsingSourceBank");
}

rule TransformAcuanTransactionIncomeMultifinance "When it's income for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWAF" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionIncomeMultifinance");
}

rule TransformAcuanTransactionIncomeMultifinanceWithFlagOJK "When it's income for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWAF" && (Acuan.GetSourceBankAccountInMeta() == "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default-ojk", Acuan.SourceAccountId);
        JournalCredit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionIncomeMultifinanceWithFlagOJK");
}

rule TransformAcuanTransactionIncomeMultifinanceUsingSourceBank "When it's income for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFWAF" && (Acuan.GetSourceBankAccountInMeta() != "") && Flag.IsEnabled("PAS-BE-multifinance") && Flag.IsEnabled("PAS-BE-ojk") 
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetSourceBankAccountInMeta();
        JournalCredit1.Narrative = "Forwarding profit to Operations";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionIncomeMultifinanceUsingSourceBank");
}

rule TransformAcuanTransactionMoneyflowBorrower "When it's disbursement moneyflow borrower, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" &&
        (Acuan.GetLoanKind() != "" && Acuan.GetPartnerId() != "") &&
        Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByParams(Transaction.MappingInterface(
            "loanKind", Acuan.GetLoanKind(),
            "partnerId", Acuan.GetPartnerId(),
            "entityCode", Transaction.GetEntityByParams(
                Transaction.MappingInterface("name", Acuan.GetEntityInMeta()))), 2);
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowBorrower");
}

rule TransformAcuanTransactionDisbursementPLMultifinance "When it's disbursement partnership loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAA" && 
        (Acuan.GetLoanKind() == "" || Acuan.GetPartnerId() == "") &&
        Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByEntityProductInMetaAndDescription2(Acuan);
        JournalDebit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Disburse to Loan account " + Acuan.GetLoanAccountNumber() + " - loan id " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementPLMultifinance");
}

rule TransformAcuanTransactionDisbursementOutstandingPLMultifinance "When it's disbursement outstanding partnership loan for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber(Acuan.Description, Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Borrower receive funding";
        Journal.Transactions.Append(JournalCredit1);
     
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLMultifinance");
}

rule TransformAcuanTransactionForwardRepaymentMultifinance "When acuan transaction type is forward repayment profit to lenders for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber(Acuan.Description, Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentMultifinance");
}

rule TransformAcuanTransactionForwardRepaymentLenderIncomeMultifinance "When acuan transaction type is forward repayment lender tax income for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber(Acuan.Description, Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderIncomeMultifinance");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionMultifinance "When acuan transaction type is forward repayment loan deduction for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber(Acuan.Description, Acuan.SourceAccountId);
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionMultifinance");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaMultifinance "When acuan transaction type is forward repayment interest amartha for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber(Acuan.Description, Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaMultifinance");
}

rule TransformAcuanTransactionMoneyflowPaymentModalByPoketMultifinance "When acuan transaction type Moneyflow Payment Modal by Poket for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFFMD" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = "261003000000001";
        JournalDebit1.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.DestinationAccountId);
        JournalCredit2.Narrative = "Moneyflow Repayment Modal via Poket";
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowPaymentModalByPoketMultifinance");
}

rule TransformAcuanTransactionPaymentModalByPoketMultifinance "When acuan transaction type is Payment Modal by Poket for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYMD" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Repayment Modal via Poket";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261003000000001";
        JournalCredit1.Narrative = "Repayment Modal via Poket";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPaymentModalByPoketMultifinance");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNMultifinance "When acuan transaction type is forward repayment partner loan - ppn multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" && Flag.IsEnabled("PAS-BE-multifinance") && !Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber(Acuan.Description, Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNMultifinance");
}

rule TransformAcuanTransactionMoneyflowRefundPeldinGLFromModalMultifinance "When it's Money Flow Refund Peldin GL from Modal for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFMMP" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("default", Acuan.SourceAccountId);
        JournalDebit1.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "143003000000007";
        JournalCredit2.Narrative = "Moneyflow Refund Modal via Poket " + Acuan.GetPaymentDate();
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowRefundPeldinGLFromModalMultifinance");
}

rule TransformAcuanTransactionAdminFeeDisbursementDeductionLMultifinance "When it's Admin fee Disbursement Deduction for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMDE"
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByEntityProductInMetaAndDescription2(Acuan);
        JournalDebit1.Narrative = "Bank Admin for Disbursement " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Bank Admin for Disbursement " + Acuan.GetLoanIdInMeta();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeDisbursementDeductionLMultifinance");
}

rule TransformAcuanTransactionPPOBDiscountVoucher "When acuan transaction type is PPOB Discount Voucher, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYVP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Deduct Deposit Voucherify for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deduct Deposit Voucherify for Payment PPOB by Poket - " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPPOBDiscountVoucher");
}

rule TransformAcuanTransactionDepositBalanceOperationalVoucherify "When acuan transaction type is deposit voucher, transform to Deposit Balance from Operational for Voucherify" salience 10 {
    when
        Acuan.TransactionType == "ADMDV"
    then
        JournalDebit1.Account = "141003000000005";
        JournalDebit1.Narrative = "Deposit Balance from Operational for Voucherify";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deposit Balance from Operational for Voucherify";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositBalanceOperationalVoucherify");
}

rule TransformAcuanTransactionRefundVourcherify "When acuan transaction type is Refund PPOB - Discount Voucher, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RFDVP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Refund Vourcherify - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Refund Vourcherify - " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRefundVourcherify");
}

rule TransformAcuanTransactionForwardAdminFeeDigiasia "When acuan transaction type is admin fee digiasia, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMDU"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Admin Fee Digiasia " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "143003000000009";
        JournalCredit1.Narrative = "Admin Fee Digiasia " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardAdminFeeDigiasia");
}

rule TransformAcuanTransactionDepositDiscountForPPOB "When acuan transaction type is deposit operational PPOB from ANR, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMPN"
    then
        JournalDebit1.Account = "141003000000005";
        JournalDebit1.Narrative = "Deposit Discount for PPOB";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deposit Discount for PPOB";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositDiscountForPPOB");
}

rule TransformAcuanTransactionMoneyflowPeldinGLAWF "When it's Moneyflow Peldin Group Loan from AWF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MWMPD"
    then
        JournalDebit1.Account = "261005000000008";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = Acuan.DestinationAccountId;
        JournalDebit2.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = "143001000000012";
        JournalCredit2.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowPeldinGLAWF");
}

rule TransformAcuanTransactioMoneyflowPeldinGroupLoanfromAMF "When acuan transaction type is Moneyflow Peldin Group Loan from AMF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MMWPD"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "143005000000011";
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        JournalDebit2.Account = "261001000000009";
        JournalDebit2.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.SourceAccountId;
        JournalCredit2.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit2);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactioMoneyflowPeldinGroupLoanfromAMF");
}

rule TransformAcuanTransactioDiscountH2HCashOutPoketUser "When acuan transaction type is Discount - H2H Cash Out Poket User, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMMD"
    then
        JournalDebit1.Account = "146003000000001";
        JournalDebit1.Narrative = "Discount From Fee Remittance "+ Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Discount From Fee Remittance "+ Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactioDiscountH2HCashOutPoketUser");
}

rule TransformAcuanTransactionFeeRemittanceH2HCashOutPoketUser "When it's Fee Remittance - H2H Cash Out Poket User, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMMV"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Admin Fee From Remittance "+ Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "262003000000001";
        JournalCredit1.Narrative = "Admin Fee From Remittance "+ Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionFeeRemittanceH2HCashOutPoketUser");
}

rule TransformAcuanTransactionAdminFeeViaMidtrans3 "When it's Admin Fee via Midtrans, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMPE"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Admin Fee Midtrans charged to User "+ Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "IDR1105200042000";
        JournalCredit1.Narrative = "Admin Fee Midtrans charged to User "+ Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeViaMidtrans3");
}


rule TransformAcuanTransactionDisburseToLoanRebook "When it's Disburse to Loan Rebook, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBLB"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Disburse to new Loan "+ Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Disburse to new Loan "+ Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisburseToLoanRebook");
}

rule TransformAcuanTransactionGeneralCashout "When it's General Cashout, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "COTGC"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionGeneralCashout");
}

rule TransformAcuanTransactionGeneralCashin "When it's General Cashin, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPGC"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Poket Changes Basic to Premium";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Poket Changes Basic to Premium";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionGeneralCashin");
}

rule TransformAcuanTransactionRecoverFund "When it's recover fund from ON BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYRD"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Recover Fund from ON BS";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Recover Fund from ON BS";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRecoverFund");
}

rule TransformAcuanTransactionRepaymentFund "When it's repayment from ON BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYTD"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Repayment from ON BS Fund";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("NORMAL", Acuan.DestinationAccountId);
        JournalCredit1.Narrative = "Repayment from ON BS Fund";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentFund");
}

rule TransformAcuanTransactionBankTransferPeldis "When it's bank transfer peldis, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYPD"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Receipt for Loan Discount Repayment";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Receipt for Loan Discount Repayment";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBankTransferPeldis");
}
rule TransformAcuanTransactionForwardRepaymentGeneralLoanPartner "When acuan transaction type is forward repayment partner loan - lender profit, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" && 
        (Acuan.GetLoanAccountNumber() != "") &&
        Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 2);
        JournalDebit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentGeneralLoanPartner");
}

rule TransformAcuanTransactionForwardRepaymentLenderIncomeGeneralLoanPartner "When acuan transaction type is forward repayment lender tax income, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" && 
        (Acuan.GetLoanAccountNumber() != "") &&
        Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 2);
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderIncomeGeneralLoanPartner");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionGeneralLoanPartner "When acuan transaction type is forward repayment loan deduction, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" && 
        (Acuan.GetLoanAccountNumber() != "") &&
        Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 2);
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionGeneralLoanPartner");
}

rule TransformAcuanTransactionDisbursementOutstandingPLGeneralLoanPartner "When it's disbursement outstanding partnership loan for multifinance, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBAB" && Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Allocated borrower to receive funding";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 1);
        JournalCredit1.Narrative = "Allocated borrower to receive funding";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingPLGeneralLoanPartner");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionGeneralLoanPartner "When it's platform/admin fee revenue portion, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" && Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 1);
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionGeneralLoanPartner");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionGeneralLoanPartner "When it's platform/admin fee vat out portion, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" && Flag.IsEnabled("PAS-BE-general-mapping-loan-partner")
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 1);
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionGeneralLoanPartner");
}

rule TransformAcuanTransactionForwardRepaymentInterestAmartha "When acuan transaction type is Forward Repayment - Interest Amartha, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" && 
        (Acuan.GetLoanAccountNumber() != "") &&
        Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 2);
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentInterestAmartha");
}

rule TransformAcuanTransactionForwardDeductionTaxLender "When acuan transaction type is forward deduction of income tax to lenders, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" && 
        (Acuan.GetLoanAccountNumber() != "") &&
        Flag.IsEnabled("PAS-BE-general-mapping-loan-partner") &&
        Acuan.GetPaymentMethodInMeta() != "virtual account"
    then
        JournalDebit1.Account = Transaction.GetLoanPartnerByLoanAccountNumberAccountType(Acuan.GetLoanAccountNumber(), 2);
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardDeductionTaxLender");
}

rule TransformAcuanTransactionPlatformFeeRevenuePortionModal "When it's platform/admin fee revenue portion with description Modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRP" &&
        Acuan.Description == "MODAL_LOAN" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("MODAL_LOAN", Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeRevenuePortionModal");
}

rule TransformAcuanTransactionPlatformFeeVATOutPortionModal "When it's platform/admin fee revenue portion with description Modal, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBRQ" &&
        Acuan.Description == "MODAL_LOAN" && Flag.IsEnabled("PAS-BE-multifinance")
    then
        JournalDebit1.Account = Transaction.MultiGetAccountByDescriptionAndAccountNumber("MODAL_LOAN", Acuan.DestinationAccountId);
        JournalDebit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "PPN Platform/Admin fee from Disbursement Loan";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPlatformFeeVATOutPortionModal");
}

rule TransformAcuanTransactionTopUpDiscountAFAAdminFee "When it's discount admin fee for Top Up AFA" salience 10 {
    when
        Acuan.TransactionType == "ADMTD"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Discount Admin Fee for User - " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Discount Admin Fee for User - " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpDiscountAFAAdminFee");
}

rule TransformAcuanTransactionTopUpAFAAdminFee "When it's admin fee for Top Up AFA" salience 10 {
    when
        Acuan.TransactionType == "ADMTV"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Admin Fee charged to User - " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Admin Fee charged to User - " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTopUpAFAAdminFee");
}

rule TransformAcuanTransactionDisbursementOutstandingGLtoMODAL "When acuan transaction type is Disburse to Outstanding Loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBTF"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = "Transfer OS Loan from GL " + Acuan.GetLoanIdInMeta() + " - " + Acuan.SourceAccountId + " to Modal " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Transfer OS Loan from GL " + Acuan.GetLoanIdInMeta() + " - " + Acuan.SourceAccountId + " to Modal " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDisbursementOutstandingGLtoMODAL");
}

rule TransformAcuanTransactionQRISIssuing "When acuan transaction type is payment QRIS Issuing, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "PAYQR"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transaction Issuing QRIS " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "261003000000010";
        JournalCredit1.Narrative = "Transaction Issuing QRIS " + Acuan.SourceAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionQRISIssuing");
}

rule TransformAcuanTransactionMoneyflowQRISIssuingArtajasa "When acuan transaction type is money flow QRIS issuing artajasa, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFAQR"
    then
        JournalDebit1.Account = "261003000000010";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowQRISIssuingArtajasa");
}

rule TransformAcuanTransactionQRISAcquiring "When acuan transaction type is payment QRIS Acquiring, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPQR"
    then
        JournalDebit1.Account = "143003000000013";
        JournalDebit1.Narrative = "Transaction Acquiring QRIS " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Transaction Acquiring QRIS " + Acuan.DestinationAccountId;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionQRISAcquiring");
}

rule TransformAcuanTransactionMoneyflowQRISAcquiringArtajasa "When acuan transaction type is money flow QRIS acquiring artajasa, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MFAAJ"
    then
        JournalDebit1.Account = Acuan.DestinationAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "143003000000013";
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionMoneyflowQRISAcquiringArtajasa");
}

rule TransformAcuanTransactionDepositOperationalBudgetCashback "When it's deposit operational budget cashback, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMOC"
    then
        JournalDebit1.Account = "230001713145";
        JournalDebit1.Narrative = "Deposit General Cashback " + Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);
        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Deposit General Cashback " + Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositOperationalBudgetCashback");
}

rule TransformAcuanTransactionGeneralCashinCashback "When it's general cash in cashback, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPCB"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);
        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);
        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionGeneralCashinCashback");
}


rule TransformAcuanTransactionAdminFeeViaMidtransAMF "When acuan transaction type is admin fee via midtrans AMF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMMA"
    then
        JournalDebit1.Account = "IDR1104100011000";
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "145001000000002";
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionAdminFeeViaMidtransAMF");
}

rule TransformAcuanTransactionUtilizationDeposit "When acuan transaction type is utilization deposit, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "TUPPP"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Use of provision budget";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative ="Use of provision budget";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionUtilizationDeposit");
}

rule TransformAcuanTransactionDepositProvisionOffBS "When acuan transaction type is deposit provision to OFF BS, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "ADMPP" && (Acuan.GetAccountNumberBank() != "")
    then
        JournalDebit1.Account = Acuan.GetAccountNumberBank();
        JournalDebit1.Narrative = "Receive provision fund from ON BS and allocate to provision deposit account";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative ="Receive provision fund from ON BS and allocate to provision deposit account";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionDepositProvisionOffBS");
}

rule TransformAcuanTransactionTransferStopInvestmentAMF "When acuan transaction type is Transfer Stop Investment AMF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "SIVTF"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetLoanAccountNumber();
        JournalCredit1.Narrative ="Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionTransferStopInvestmentAMF");
}

rule TransformAcuanTransactionBuybackAWF "When acuan transaction type is Buyback AWF, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "BBLTF"
    then
        JournalDebit1.Account = Acuan.GetLoanAccountNumber();
        JournalDebit1.Narrative = "Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative ="Transfer Portofolio " + Acuan.GetLoanAccountNumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionBuybackAWF");
}

rule TransformAcuanTransactionReversalTransfer "When acuan transaction type is Reversal Transfer, transform mandatory debit and credit transactions" salience 10 {
    when
        Acuan.TransactionType == "RVRTF" && Acuan.GetDebitInMeta() != "" && Acuan.GetCreditInMeta() != ""
    then
        JournalDebit1.Account = Acuan.GetDebitInMeta();
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.GetCreditInMeta();
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionReversalTransfer");
}

rule TransformAcuanTransactionReversalTransferConditional "When acuan transaction type is Reversal Transfer and both debit2 and credit2 are valid, add them as a pair" salience 9 {
    when
        Acuan.TransactionType == "RVRTF" && Acuan.GetDebitInMeta() != "" && Acuan.GetCreditInMeta() != "" && Acuan.GetDebit2InMeta() != "" && Acuan.GetCredit2InMeta() != ""
    then
        JournalDebit2.Account = Acuan.GetDebit2InMeta();
        JournalDebit2.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit2);

        JournalCredit2.Account = Acuan.GetCredit2InMeta();
        JournalCredit2.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit2);

        Retract("TransformAcuanTransactionReversalTransferConditional");
}

rule TransformAcuanTransactionForwardRepaymentVA "When acuan transaction type is forward repayment partner loan - payment with virtual account, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAB" &&
        Acuan.GetPaymentMethodInMeta() == "virtual account"
    then
        JournalDebit1.Account = Transaction.GetRepaymentCashInTransitByEntity(Acuan.GetEntityCodeInMeta());
        JournalDebit1.Narrative = "Forwarding profit to lenders VA";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to lenders VA";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentVA");
}

rule TransformAcuanTransactionForwardRepaymentLenderIncomeTaxVA "When acuan transaction type is forward repayment partner loan - lender tax income & payment via virtual account, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAC" &&
        Acuan.GetPaymentMethodInMeta() == "virtual account"
    then
        JournalDebit1.Account = Transaction.GetRepaymentCashInTransitByEntity(Acuan.GetEntityCodeInMeta());
        JournalDebit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding (deduction) of income tax (Article 23) to lenders";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentLenderIncomeTaxVA");
}

rule TransformAcuanTransactionForwardRepaymentPLLoanDeductionVA "When acuan transaction type is forward repayment partner loan - loan deduction & payment via virtual account, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAE" &&
        Acuan.GetPaymentMethodInMeta() == "virtual account"
    then
        JournalDebit1.Account = Transaction.GetRepaymentCashInTransitByEntity(Acuan.GetEntityCodeInMeta());
        JournalDebit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.SourceAccountId;
        JournalCredit1.Narrative = "Forwarding Loan Deduction";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLLoanDeductionVA");
}

rule TransformAcuanTransactionForwardRepaymentPLPPNAmarthaVA "When acuan transaction type is forward repayment partner loan - ppn amartha & payment via virtual account, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAG" &&
        Acuan.GetPaymentMethodInMeta() == "virtual account"
    then
        JournalDebit1.Account = Transaction.GetRepaymentCashInTransitByEntity(Acuan.GetEntityCodeInMeta());
        JournalDebit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Tax on Amartha's Revenue";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLPPNAmarthaVA");
}

rule TransformAcuanTransactionForwardRepaymentPLInterestAmarthaVA "When acuan transaction type is forward repayment partner loan - interest amartha & payment via virtual account, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAF" &&
        Acuan.GetPaymentMethodInMeta() == "virtual account"
    then
        JournalDebit1.Account = Transaction.GetRepaymentCashInTransitByEntity(Acuan.GetEntityCodeInMeta());
        JournalDebit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Forwarding profit to Amartha";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardRepaymentPLInterestAmarthaVA");
}

rule TransformAcuanTransactionRepaymentCashless "When acuan transaction type is repayment partner loan cashless, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "RPYAA" &&
        Acuan.DestinationAccountId == Transaction.GetRepaymentCashInTransitByEntity(Acuan.GetEntityInMeta())
    then
        JournalDebit1.Account = Transaction.GetBankHOPoolingRepaymentByEntity(Acuan.GetEntityInMeta());
        JournalDebit1.Narrative = "Cashless Repayment from VA " + Acuan.GetVANumber();
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = "Cashless Repayment from VA " + Acuan.GetVANumber();
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionRepaymentCashless");
}

rule TransformAcuanTransactionPremiInsuranceFromDisbursementLoan "When it's Premi Insurance from Disbursement Loan, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "DSBPI"
    then
        JournalDebit1.Account = Transaction.GetAccountByEntityDestination(Acuan.DestinationAccountId);
        JournalDebit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = Acuan.DestinationAccountId;
        JournalCredit1.Narrative = Acuan.Description;
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionPremiInsuranceFromDisbursementLoan");
}

rule TransformAcuanTransactionForwardPremiInsuranceToAFGMMWPI "When it's Forward Premi Insurance to AFG MMWPI, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MMWPI"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forward Premi Insurance to AFG";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114001000000057";
        JournalCredit1.Narrative = "Forward Premi Insurance to AFG";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardPremiInsuranceToAFGMMWPI");
}

rule TransformAcuanTransactionForwardPremiInsuranceToAFGMWMPI "When it's Forward Premi Insurance to AFG MWMPI, transform to transaction PAS" salience 10 {
    when
        Acuan.TransactionType == "MWMPI"
    then
        JournalDebit1.Account = Acuan.SourceAccountId;
        JournalDebit1.Narrative = "Forward Premi Insurance to AFG";
        Journal.Transactions.Append(JournalDebit1);

        JournalCredit1.Account = "114005000000055";
        JournalCredit1.Narrative = "Forward Premi Insurance to AFG";
        Journal.Transactions.Append(JournalCredit1);

        Transaction.IsReadyToPublish = true;
        Retract("TransformAcuanTransactionForwardPremiInsuranceToAFGMWMPI");
}

rule PublishJournalTransaction "When journal transaction is ready to publish, publish it" salience -1 {
    when
        Transaction.IsReadyToPublish == true
    then
        Transaction.Publish();
        Retract("PublishJournalTransaction");
}